<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wooldridge Ch. 18: Advanced Time Series Topics</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Source+Code+Pro:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        :root {
            --primary-green: #2E8B57;
            --secondary-red: #DC143C;
            --academic-navy: #2C3E50;
            --light-green: #90EE90;
            --turquoise: #40E0D0;
            --neutral-lightgray: #F5F5F5;
            --background-cream: #FAFAFA;
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #DC143C;
            --deep-blue: #1E3A8A;
            --light-blue: #87CEEB;
            --sophisticated-gold: #D4AF37;
            --research-silver: #C0C0C0;
            --advanced-purple: #6B46C1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--background-cream) 0%, #F8FAFC 50%, #F1F5F9 100%);
            color: var(--text-primary);
            line-height: 1.65;
            overflow-x: hidden;
            position: relative;
        }

        /* Sophisticated background patterns for advanced content */
        body::before {
            content: '';
            position: fixed;
            top: -60%;
            left: -60%;
            width: 220%;
            height: 220%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(46, 139, 87, 0.02) 0%, transparent 45%),
                radial-gradient(circle at 85% 75%, rgba(64, 224, 208, 0.025) 0%, transparent 50%),
                radial-gradient(circle at 45% 55%, rgba(44, 62, 80, 0.015) 0%, transparent 40%),
                radial-gradient(circle at 75% 25%, rgba(212, 175, 55, 0.01) 0%, transparent 35%),
                radial-gradient(circle at 25% 75%, rgba(107, 70, 193, 0.01) 0%, transparent 30%);
            animation: sophisticatedFlow 30s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes sophisticatedFlow {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.8; }
            20% { transform: rotate(72deg) scale(1.03); opacity: 0.9; }
            40% { transform: rotate(144deg) scale(0.97); opacity: 0.85; }
            60% { transform: rotate(216deg) scale(1.02); opacity: 0.95; }
            80% { transform: rotate(288deg) scale(0.98); opacity: 0.87; }
        }

        .container {
            max-width: 1800px;
            margin: 30px auto;
            background: rgba(255, 255, 255, 0.97);
            box-shadow: 
                0 0 120px rgba(44, 62, 80, 0.12),
                0 25px 80px rgba(46, 139, 87, 0.08),
                0 10px 40px rgba(64, 224, 208, 0.05);
            border-radius: 35px;
            overflow: hidden;
            backdrop-filter: blur(15px);
            animation: academicEntry 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(64, 224, 208, 0.2);
        }

        @keyframes academicEntry {
            from {
                opacity: 0;
                transform: scale(0.92) translateY(60px) rotateX(15deg);
                filter: blur(12px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotateX(0deg);
                filter: blur(0);
            }
        }

        /* Sophisticated Header Design */
        .header-section {
            background: linear-gradient(135deg, var(--academic-navy) 0%, #1a252f 30%, #34495e 70%, #2c3e50 100%);
            color: white;
            padding: 60px 50px;
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                transparent 0%, 
                rgba(64, 224, 208, 0.08) 20%, 
                transparent 40%, 
                rgba(212, 175, 55, 0.06) 60%, 
                transparent 80%, 
                rgba(107, 70, 193, 0.05) 100%);
            animation: academicFlow 12s ease-in-out infinite;
        }

        @keyframes academicFlow {
            0%, 100% { 
                transform: translateX(-150px) scale(1) skewX(0deg); 
                opacity: 0.7; 
            }
            33% { 
                transform: translateX(0px) scale(1.1) skewX(10deg); 
                opacity: 0.9; 
            }
            66% { 
                transform: translateX(150px) scale(0.9) skewX(-5deg); 
                opacity: 0.8; 
            }
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 4.2em;
            font-weight: 900;
            margin-bottom: 25px;
            text-shadow: 3px 6px 12px rgba(0,0,0,0.4);
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, white 0%, #E2E8F0 30%, var(--sophisticated-gold) 70%, white 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleSophistication 4s ease-in-out infinite alternate;
        }

        @keyframes titleSophistication {
            from { 
                filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.4)); 
                transform: scale(1);
            }
            to { 
                filter: drop-shadow(0 0 25px rgba(64, 224, 208, 0.6)); 
                transform: scale(1.01);
            }
        }

        .header-subtitle {
            font-size: 1.8em;
            font-weight: 300;
            opacity: 0.94;
            position: relative;
            z-index: 2;
            color: var(--turquoise);
            text-shadow: 1px 2px 6px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }

        /* Refined Navigation */
        .nav-tabs {
            display: flex;
            background: linear-gradient(90deg, var(--primary-green) 0%, #228B22 50%, var(--primary-green) 100%);
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 0 rgba(64, 224, 208, 0.3);
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 20%;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.05) 0%, 
                rgba(212, 175, 55, 0.15) 50%, 
                rgba(255,255,255,0.05) 100%);
            transform: translateX(-100%);
            animation: sophisticatedNav 8s ease-in-out infinite;
        }

        @keyframes sophisticatedNav {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(500%); }
        }

        .tab-button {
            flex: 1;
            padding: 28px 30px;
            background: none;
            border: none;
            color: white;
            font-weight: 500;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 4px solid transparent;
            position: relative;
            z-index: 2;
            letter-spacing: 0.5px;
        }

        .tab-button:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateY(-6px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            color: var(--sophisticated-gold);
        }

        .tab-button.active {
            background: rgba(64, 224, 208, 0.25);
            border-bottom-color: var(--sophisticated-gold);
            font-weight: 600;
            color: var(--sophisticated-gold);
            box-shadow: inset 0 -4px 0 var(--sophisticated-gold);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 60px;
            animation: academicSlide 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .content-section.active {
            display: block;
        }

        @keyframes academicSlide {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.97);
                filter: blur(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        /* Section Titles - RED (Sophisticated) */
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 3.4em;
            color: var(--secondary-red);
            margin-bottom: 50px;
            text-align: center;
            font-weight: 700;
            position: relative;
            text-shadow: 2px 3px 8px rgba(0,0,0,0.1);
            letter-spacing: -1px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--turquoise) 0%, 
                var(--light-blue) 25%, 
                var(--sophisticated-gold) 50%, 
                var(--light-blue) 75%, 
                var(--turquoise) 100%);
            border-radius: 2px;
            animation: sophisticatedUnderline 3s ease-in-out infinite alternate;
        }

        @keyframes sophisticatedUnderline {
            from { width: 150px; opacity: 0.7; }
            to { width: 220px; opacity: 1; }
        }

        /* Advanced Theory Framework */
        .theory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
            gap: 40px;
            margin-bottom: 60px;
        }

        .theory-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #FEFEFE 50%, #F9FAFB 100%);
            padding: 45px;
            border-radius: 25px;
            border-left: 8px solid var(--turquoise);
            box-shadow: 
                0 15px 45px rgba(44, 62, 80, 0.08),
                0 5px 20px rgba(64, 224, 208, 0.1);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .theory-card::before {
            content: '';
            position: absolute;
            top: -30px;
            right: -30px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, 
                rgba(64, 224, 208, 0.08) 0%, 
                rgba(212, 175, 55, 0.05) 40%, 
                transparent 70%);
            border-radius: 50%;
            animation: cardSophistication 6s ease-in-out infinite;
        }

        @keyframes cardSophistication {
            0%, 100% { 
                transform: scale(1) translateX(0) translateY(0) rotate(0deg); 
                opacity: 0.6; 
            }
            33% { 
                transform: scale(1.2) translateX(20px) translateY(-20px) rotate(120deg); 
                opacity: 0.8; 
            }
            66% { 
                transform: scale(0.9) translateX(-10px) translateY(10px) rotate(240deg); 
                opacity: 0.7; 
            }
        }

        .theory-card:hover {
            transform: translateY(-15px) rotateX(8deg) rotateY(2deg);
            box-shadow: 
                0 25px 60px rgba(44, 62, 80, 0.12),
                0 10px 30px rgba(212, 175, 55, 0.1);
            border-left-color: var(--sophisticated-gold);
        }

        .theory-card h3 {
            font-family: 'Playfair Display', serif;
            color: var(--secondary-red);
            margin-bottom: 25px;
            font-size: 1.9em;
            font-weight: 700;
            position: relative;
            z-index: 2;
            letter-spacing: -0.5px;
        }

        .theory-card p {
            font-size: 1.15em;
            line-height: 1.8;
            margin-bottom: 18px;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }

        /* Mathematical Equations - Advanced Styling */
        .equation-display {
            background: linear-gradient(135deg, var(--academic-navy) 0%, #2C5282 50%, var(--academic-navy) 100%);
            color: white;
            padding: 38px;
            border-radius: 20px;
            margin: 30px 0;
            font-family: 'Source Code Pro', monospace;
            font-size: 1.25em;
            box-shadow: 
                inset 0 3px 20px rgba(0,0,0,0.4), 
                0 12px 35px rgba(44, 62, 80, 0.25);
            overflow-x: auto;
            border: 3px solid rgba(64, 224, 208, 0.4);
            position: relative;
        }

        .equation-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--turquoise) 20%, 
                var(--sophisticated-gold) 50%, 
                var(--turquoise) 80%, 
                transparent 100%);
            animation: equationSophistication 5s ease-in-out infinite;
        }

        @keyframes equationSophistication {
            0%, 100% { opacity: 0.4; transform: scaleX(0.6); }
            50% { opacity: 1; transform: scaleX(1.4); }
        }

        /* Interactive Controls - Luxury Design */
        .control-panel {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 30%, #E2E8F0 70%, #F8FAFC 100%);
            padding: 50px;
            border-radius: 30px;
            margin: 50px 0;
            border: 4px solid var(--turquoise);
            box-shadow: 
                0 20px 50px rgba(64, 224, 208, 0.15),
                inset 0 2px 0 rgba(255,255,255,0.9);
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: -80%;
            left: -80%;
            width: 260%;
            height: 260%;
            background: conic-gradient(from 0deg at 50% 50%, 
                transparent 0%, 
                rgba(64, 224, 208, 0.03) 15%, 
                transparent 30%, 
                rgba(212, 175, 55, 0.02) 45%, 
                transparent 60%, 
                rgba(107, 70, 193, 0.02) 75%, 
                transparent 90%);
            animation: controlSophistication 20s linear infinite;
        }

        @keyframes controlSophistication {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .control-header {
            font-family: 'Playfair Display', serif;
            color: var(--secondary-red);
            font-size: 2.4em;
            margin-bottom: 35px;
            text-align: center;
            font-weight: 700;
            position: relative;
            z-index: 2;
            letter-spacing: -0.5px;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 35px;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.15em;
            letter-spacing: 0.3px;
        }

        .form-group select,
        .form-group input {
            padding: 20px;
            border: 3px solid #E5E7EB;
            border-radius: 15px;
            font-size: 1.1em;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--sophisticated-gold);
            box-shadow: 
                0 0 30px rgba(212, 175, 55, 0.3),
                0 0 0 6px rgba(64, 224, 208, 0.1);
            transform: translateY(-4px) scale(1.02);
        }

        /* Advanced Action Buttons */
        .button-group {
            display: flex;
            gap: 25px;
            margin-top: 40px;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .btn {
            padding: 22px 42px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            font-size: 1.15em;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.5) 50%, 
                transparent 100%);
            transition: left 0.8s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green) 0%, #228B22 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(46, 139, 87, 0.35);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #228B22 0%, var(--primary-green) 100%);
            transform: translateY(-6px);
            box-shadow: 0 15px 45px rgba(46, 139, 87, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--sophisticated-gold) 0%, #B8860B 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.35);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #B8860B 0%, var(--sophisticated-gold) 100%);
            transform: translateY(-6px);
            box-shadow: 0 15px 45px rgba(212, 175, 55, 0.4);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--advanced-purple) 0%, #553C9A 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(107, 70, 193, 0.35);
        }

        .btn-accent:hover {
            background: linear-gradient(135deg, #553C9A 0%, var(--advanced-purple) 100%);
            transform: translateY(-6px);
            box-shadow: 0 15px 45px rgba(107, 70, 193, 0.4);
        }

        /* Results Display - Luxury Academic */
        .results-container {
            background: linear-gradient(135deg, #FFFFFF 0%, #FEFEFE 100%);
            border: 4px solid var(--turquoise);
            border-radius: 30px;
            padding: 50px;
            margin: 50px 0;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.12),
                inset 0 1px 0 rgba(255,255,255,0.9);
            position: relative;
            overflow: hidden;
        }

        .results-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, 
                var(--turquoise) 0%, 
                var(--light-blue) 20%, 
                var(--turquoise) 40%, 
                var(--advanced-purple) 60%, 
                var(--light-blue) 80%, 
                var(--turquoise) 100%);
            animation: resultsFlow 4s ease-in-out infinite;
        }

        @keyframes resultsFlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .results-header {
            font-family: 'Playfair Display', serif;
            font-size: 2.6em;
            color: var(--secondary-red);
            margin-bottom: 35px;
            text-align: center;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* Chart Container - Advanced */
        .chart-container {
            position: relative;
            height: 550px;
            margin: 50px 0;
            background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 3px solid var(--light-blue);
        }

        /* Statistics Grid - Sophisticated */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 35px;
            margin: 45px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #FAFAFA 0%, #F1F5F9 100%);
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            border: 3px solid #E5E7EB;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--turquoise) 0%, var(--light-blue) 50%, var(--turquoise) 100%);
            transform: scaleX(0);
            transition: transform 0.5s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-value {
            font-family: 'Source Code Pro', monospace;
            font-size: 2em;
            font-weight: 600;
            color: var(--turquoise);
            margin-bottom: 12px;
        }

        .stat-label {
            font-size: 1.1em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* VAR Specific Elements */
        .var-info {
            background: linear-gradient(135deg, #F3E8FF 0%, #F9F5FF 100%);
            border: 3px solid var(--advanced-purple);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .var-system {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .var-equation {
            background: var(--advanced-purple);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.95em;
        }

        /* Decision Framework */
        .decision-panel {
            background: linear-gradient(135deg, #F0FFFF 0%, rgba(64, 224, 208, 0.2) 100%);
            border: 4px solid var(--turquoise);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
        }

        .decision-question {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            font-size: 1.5em;
            margin-bottom: 30px;
            color: var(--academic-navy);
            text-align: center;
            letter-spacing: -0.3px;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .decision-option {
            padding: 25px;
            background: white;
            border: 3px solid #E5E7EB;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            font-weight: 500;
            font-size: 1.05em;
        }

        .decision-option:hover {
            border-color: var(--sophisticated-gold);
            background: #FFFBEB;
            transform: translateY(-6px);
        }

        .decision-option.selected {
            border-color: var(--turquoise);
            background: #F0FFFF;
            box-shadow: 0 0 25px rgba(64, 224, 208, 0.3);
        }

        /* Feedback Messages */
        .feedback-message {
            padding: 35px;
            border-radius: 20px;
            margin: 35px 0;
            font-weight: 500;
            font-size: 1.15em;
        }

        .feedback-success {
            background: #F0FFFF;
            border: 3px solid var(--turquoise);
            color: #0D5F5F;
        }

        .feedback-warning {
            background: #FFF8E1;
            border: 3px solid var(--warning);
            color: #8B4513;
        }

        .feedback-danger {
            background: #FFE4E6;
            border: 3px solid var(--secondary-red);
            color: #721c24;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 20px;
                border-radius: 25px;
            }

            .header-title {
                font-size: 3em;
            }

            .theory-grid {
                grid-template-columns: 1fr;
            }

            .control-group {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Wooldridge References */
        .wooldridge-note {
            background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 6px solid var(--turquoise);
            font-style: italic;
            position: relative;
        }

        .wooldridge-note::before {
            content: 'üìö';
            position: absolute;
            top: 30px;
            left: 25px;
            font-size: 1.4em;
        }

        .wooldridge-note p {
            margin-left: 40px;
            line-height: 1.8;
        }

        /* Advanced Visual Effects */
        .granger-test {
            background: rgba(212, 175, 55, 0.1);
            border-left: 5px solid var(--sophisticated-gold);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .impulse-response {
            display: inline-block;
            background: linear-gradient(135deg, var(--turquoise) 0%, #20B2AA 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Source Code Pro', monospace;
            font-weight: 600;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="header-title">Wooldridge Ch. 18: Advanced Time Series</h1>
            <p class="header-subtitle">VAR Models, Granger Causality & Impulse Response Functions</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-button active" onclick="showSection('theory')">üî¨ VAR & Causality</button>
            <button class="tab-button" onclick="showSection('simulation')">üìà VAR Estimation</button>
            <button class="tab-button" onclick="showSection('analysis')">‚ö° Impulse Response</button>
            <button class="tab-button" onclick="showSection('assessment')">‚úÖ Assessment Mode</button>
        </div>

        <!-- Theory Framework Section -->
        <div id="theory" class="content-section active">
            <h2 class="section-title">Wooldridge Ch. 18 Advanced Framework</h2>
            
            <div class="theory-grid">
                <div class="theory-card">
                    <h3>üîó Vector Autoregression (VAR)</h3>
                    <p><strong>Wooldridge VAR System:</strong> Multivariate generalization where each variable depends on its own lags and lags of all other variables in the system</p>
                    <div class="equation-display">
                        VAR(p): Y‚Çú = A‚ÇÅY‚Çú‚Çã‚ÇÅ + A‚ÇÇY‚Çú‚Çã‚ÇÇ + ... + A‚ÇöY‚Çú‚Çã‚Çö + U‚Çú<br>
                        where Y‚Çú = (y‚ÇÅ‚Çú, y‚ÇÇ‚Çú, ..., y‚Çò‚Çú)' is m√ó1 vector
                    </div>
                    <p><em>Each equation has same regressors - symmetric treatment of variables</em></p>
                </div>

                <div class="theory-card">
                    <h3>‚öñÔ∏è Granger Causality</h3>
                    <p><strong>Wooldridge Definition:</strong> X Granger-causes Y if past values of X help predict Y beyond what Y's own past values provide</p>
                    <div class="equation-display">
                        H‚ÇÄ: X does not Granger-cause Y<br>
                        Test: F-test on lagged X coefficients in Y equation<br>
                        F = (SSR_R - SSR_U)/q √∑ SSR_U/(T-k)
                    </div>
                    <p><strong>Interpretation:</strong> Statistical concept, not true causation</p>
                </div>

                <div class="theory-card">
                    <h3>‚ö° Impulse Response Functions</h3>
                    <p><strong>Dynamic Response Analysis:</strong> Trace out effect of one-unit innovation in variable i on variable j over time</p>
                    <div class="equation-display">
                        IRF: ‚àÇY_{t+h}/‚àÇŒµ_{i,t} for h = 0, 1, 2, ...<br>
                        VMA representation: Y‚Çú = Œ£‚Çç‚Çï‚Çå‚ÇÄ‚Çé^‚àû Œ¶‚ÇïŒµ‚Çú‚Çã‚Çì<br>
                        where Œ¶‚Çï are impulse response matrices
                    </div>
                    <p><strong>Policy use:</strong> Understanding shock transmission mechanisms</p>
                </div>

                <div class="theory-card">
                    <h3>üìä Variance Decomposition</h3>
                    <p><strong>Wooldridge Framework:</strong> Decompose forecast error variance into proportions attributable to each variable's innovations</p>
                    <div class="equation-display">
                        Var(Y_{t+h}|Œ©‚Çú) = Œ£·µ¢‚Çå‚ÇÅ·µê œâ·µ¢,‚Çï<br>
                        where œâ·µ¢,‚Çï = contribution of variable i to h-step forecast error
                    </div>
                    <p><strong>Insight:</strong> Relative importance of variables over different horizons</p>
                </div>

                <div class="theory-card">
                    <h3>üîÑ Vector Error Correction (VECM)</h3>
                    <p><strong>Cointegrated VAR:</strong> When variables are I(1) but cointegrated, use VECM representation</p>
                    <div class="equation-display">
                        VECM: ŒîY‚Çú = Œ±Œ≤'Y‚Çú‚Çã‚ÇÅ + Œ£·µ¢‚Çå‚ÇÅ^{p-1} Œì·µ¢ŒîY‚Çú‚Çã·µ¢ + Œµ‚Çú<br>
                        where Œ≤' is cointegrating vector, Œ± is adjustment coefficients
                    </div>
                    <p><strong>Equilibrium:</strong> Long-run relationships with short-run dynamics</p>
                </div>

                <div class="theory-card">
                    <h3>üéØ Structural VAR (SVAR)</h3>
                    <p><strong>Economic Identification:</strong> Impose economic theory restrictions to identify structural shocks</p>
                    <div class="equation-display">
                        Structural form: AY‚Çú = A‚ÇÅY‚Çú‚Çã‚ÇÅ + ... + A‚ÇöY‚Çú‚Çã‚Çö + Be‚Çú<br>
                        Reduced form: Y‚Çú = Œ¶‚ÇÅY‚Çú‚Çã‚ÇÅ + ... + Œ¶‚ÇöY‚Çú‚Çã‚Çö + u‚Çú<br>
                        where Au‚Çú = Be‚Çú (identification problem)
                    </div>
                    <p><strong>Examples:</strong> Recursive ordering, long-run restrictions, sign restrictions</p>
                </div>
            </div>

            <div class="theory-card" style="grid-column: 1 / -1;">
                <h3>üá®üá¶ Canadian VAR Applications</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 35px; margin-top: 30px;">
                    <div>
                        <h4>üè¶ Monetary Policy Transmission:</h4>
                        <ul>
                            <li><strong>Policy VAR:</strong> Bank of Canada rate, inflation, output, exchange rate</li>
                            <li><strong>Granger Causality:</strong> Policy rate ‚Üí inflation, output</li>
                            <li><strong>IRFs:</strong> Monetary shock transmission mechanisms</li>
                            <li><strong>VDC:</strong> Relative importance of policy vs other shocks</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üìä Regional & Sectoral Dynamics:</h4>
                        <ul>
                            <li><strong>Provincial GDP:</strong> Inter-regional spillovers and convergence</li>
                            <li><strong>Commodity-Macro:</strong> Oil prices, CAD, GDP interactions</li>
                            <li><strong>Financial Markets:</strong> TSX, bond yields, bank lending</li>
                            <li><strong>Labor-Output:</strong> Employment, productivity, wage dynamics</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="wooldridge-note">
                <p><strong>üéì Wooldridge Chapter 18 Key Insight:</strong> VAR models provide a flexible framework for analyzing multivariate time series without imposing strong a priori restrictions. They excel at forecasting and understanding dynamic interactions, but require careful interpretation and sufficient data for reliable estimation.</p>
            </div>
        </div>

        <!-- Interactive VAR Simulation Section -->
        <div id="simulation" class="content-section">
            <h2 class="section-title">VAR Estimation & Analysis</h2>

            <div class="control-panel">
                <h3 class="control-header">üî¨ Canadian VAR System</h3>
                
                <div class="control-group">
                    <div class="form-group">
                        <label for="varSystem">VAR System</label>
                        <select id="varSystem" onchange="updateVARSystem()">
                            <option value="monetary">Monetary Policy VAR (4 variables)</option>
                            <option value="regional">Regional Convergence VAR</option>
                            <option value="commodity">Commodity-Macro VAR</option>
                            <option value="financial">Financial Markets VAR</option>
                            <option value="labor">Labor Market VAR</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="varLags">VAR Lag Order (p)</label>
                        <select id="varLags" onchange="updateVARLags()">
                            <option value="1">1 lag (quarterly)</option>
                            <option value="2" selected>2 lags (quarterly)</option>
                            <option value="4">4 lags (quarterly)</option>
                            <option value="6">6 lags (quarterly)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="samplePeriod">Sample Period</label>
                        <select id="samplePeriod">
                            <option value="80">Short (20 years, quarterly)</option>
                            <option value="120" selected>Medium (30 years, quarterly)</option>
                            <option value="160">Long (40 years, quarterly)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="shockSize">Shock Size (std devs)</label>
                        <input type="range" id="shockSize" min="0.5" max="3" step="0.5" value="1" onchange="updateShockDisplay()">
                        <span id="shockValue">1.0 œÉ</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="generateVARSeries()">üé≤ Generate VAR</button>
                    <button class="btn btn-secondary" onclick="estimateVAR()">üîç Estimate System</button>
                    <button class="btn btn-accent" onclick="grangerCausalityTest()">‚öñÔ∏è Granger Tests</button>
                </div>
            </div>

            <!-- VAR System Display -->
            <div id="varDescription" class="var-info">
                <div class="results-header">Current VAR System</div>
                <div id="varText"></div>
                <div id="varEquations" class="var-system"></div>
            </div>

            <!-- VAR Chart -->
            <div class="chart-container">
                <canvas id="varChart"></canvas>
            </div>
        </div>

        <!-- Impulse Response Analysis Section -->
        <div id="analysis" class="content-section">
            <h2 class="section-title">Impulse Response Analysis</h2>

            <div id="grangerResults" class="results-container">
                <div class="results-header">Granger Causality Tests</div>
                <div id="grangerTable"></div>
            </div>

            <div class="stats-grid" id="varStats">
                <!-- Dynamic statistics will be populated here -->
            </div>

            <div id="varianceDecomp" class="results-container">
                <div class="results-header">‚ö° Variance Decomposition</div>
                <div id="varianceResults"></div>
            </div>

            <!-- Impulse Response Chart -->
            <div class="chart-container">
                <h3 style="text-align: center; margin-bottom: 30px; color: var(--secondary-red);">üìà Impulse Response Functions</h3>
                <canvas id="impulseChart"></canvas>
            </div>
        </div>

        <!-- Assessment Mode Section -->
        <div id="assessment" class="content-section">
            <h2 class="section-title">Advanced VAR Assessment</h2>

            <div id="assessmentQuestion" class="decision-panel">
                <div class="decision-question">Loading advanced VAR assessment...</div>
                <div class="decision-options" id="assessmentOptions">
                    <!-- Dynamic options will be populated -->
                </div>
                <button class="btn btn-primary" onclick="checkAnswer()" style="margin-top: 35px;">Submit Answer</button>
            </div>

            <div id="assessmentFeedback"></div>

            <div class="button-group" style="margin-top: 45px;">
                <button class="btn btn-secondary" onclick="generateNewQuestion()">üìù New Question</button>
                <button class="btn btn-accent" onclick="showExpertSolution()">üéì Show Expert Solution</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentVARSeries = null;
        let currentVARChart = null;
        let impulseChart = null;
        let selectedAnswer = null;
        let currentQuestion = null;

        // VAR System Definitions
        const varSystemDefinitions = {
            monetary: {
                title: "Canadian Monetary Policy VAR",
                description: "Wooldridge-style analysis of Bank of Canada monetary policy transmission. Four-variable system analyzing how policy rate innovations transmit through the economy.",
                variables: ["Policy Rate", "CPI Inflation", "Real GDP Growth", "CAD/USD"],
                equations: ["policy_t = Œ±‚ÇÅ + lags", "inflation_t = Œ±‚ÇÇ + lags", "gdp_t = Œ±‚ÇÉ + lags", "cad_t = Œ±‚ÇÑ + lags"],
                wooldridgeNote: "Classic monetary VAR following Wooldridge framework for policy analysis",
                identification: "Recursive ordering: policy rate ‚Üí inflation ‚Üí GDP ‚Üí exchange rate",
                frequency: "Quarterly",
                source: "Bank of Canada, Statistics Canada"
            },
            regional: {
                title: "Provincial GDP Convergence VAR",
                description: "Multi-regional VAR examining economic convergence across Canadian provinces. Tests spillover effects and common economic trends.",
                variables: ["Ontario GDP", "Quebec GDP", "BC GDP", "Alberta GDP"],
                equations: ["ont_t = Œ±‚ÇÅ + lags", "que_t = Œ±‚ÇÇ + lags", "bc_t = Œ±‚ÇÉ + lags", "ab_t = Œ±‚ÇÑ + lags"],
                wooldridgeNote: "Regional convergence testing using VAR-based Granger causality",
                identification: "Size-based ordering: Ontario ‚Üí Quebec ‚Üí BC ‚Üí Alberta",
                frequency: "Quarterly",
                source: "Statistics Canada, Provincial Economic Accounts"
            },
            commodity: {
                title: "Commodity-Macro Linkages VAR",
                description: "Structural VAR analyzing how commodity price shocks transmit to Canadian macroeconomic variables through exchange rate and terms of trade.",
                variables: ["Oil Price", "CAD/USD", "CPI Inflation", "TSX Index"],
                equations: ["oil_t = Œ±‚ÇÅ + lags", "cad_t = Œ±‚ÇÇ + lags", "cpi_t = Œ±‚ÇÉ + lags", "tsx_t = Œ±‚ÇÑ + lags"],
                wooldridgeNote: "Commodity exporter VAR with external oil price shocks",
                identification: "External oil shock, then domestic transmission",
                frequency: "Monthly",
                source: "EIA, Bank of Canada, TSX"
            },
            financial: {
                title: "Financial Markets VAR",
                description: "Financial market interactions VAR examining linkages between equity, bond, and money markets in Canada.",
                variables: ["TSX Returns", "Bond Yield", "Bank Rate", "Credit Spread"],
                equations: ["tsx_t = Œ±‚ÇÅ + lags", "bond_t = Œ±‚ÇÇ + lags", "rate_t = Œ±‚ÇÉ + lags", "spread_t = Œ±‚ÇÑ + lags"],
                wooldridgeNote: "Financial VAR for risk transmission analysis",
                identification: "Market size ordering with policy rate last",
                frequency: "Monthly",
                source: "TSX, Bank of Canada, FTSE Canada"
            },
            labor: {
                title: "Labor Market Dynamics VAR", 
                description: "Labor market VAR analyzing employment, productivity, and wage interactions with output growth in Canadian labor markets.",
                variables: ["Employment Rate", "Real Wages", "Productivity", "GDP Growth"],
                equations: ["emp_t = Œ±‚ÇÅ + lags", "wage_t = Œ±‚ÇÇ + lags", "prod_t = Œ±‚ÇÉ + lags", "gdp_t = Œ±‚ÇÑ + lags"],
                wooldridgeNote: "Labor market search and matching VAR framework",
                identification: "Labor market flow: employment ‚Üí wages ‚Üí productivity ‚Üí output",
                frequency: "Monthly",
                source: "Statistics Canada, Labour Force Survey"
            }
        };

        // Assessment Questions (Wooldridge Ch. 18 focused)
        const assessmentQuestions = [
            {
                question: "According to Wooldridge, what is the key advantage of VAR models over single equation approaches?",
                options: [
                    "VARs require fewer parameters",
                    "VARs treat all variables symmetrically as endogenous",
                    "VARs have better small sample properties",
                    "VARs eliminate simultaneity bias"
                ],
                correct: 1,
                explanation: "Wooldridge emphasizes that VARs treat all variables as endogenous, avoiding the arbitrary designation of some variables as exogenous that single-equation models require."
            },
            {
                question: "In Wooldridge's Granger causality framework, what does 'X Granger-causes Y' mean?",
                options: [
                    "X is the true economic cause of Y",
                    "Past values of X help predict Y beyond Y's own past",
                    "X and Y are cointegrated",
                    "X responds immediately to changes in Y"
                ],
                correct: 1,
                explanation: "Granger causality is purely statistical - it means lagged values of X significantly improve forecasts of Y beyond what Y's own history provides."
            },
            {
                question: "According to Wooldridge, what is the main challenge in interpreting VAR impulse responses?",
                options: [
                    "The sample size is usually too small",
                    "The identification problem - structural shocks are not uniquely determined",
                    "VAR models are always misspecified",
                    "Impulse responses are not statistically significant"
                ],
                correct: 1,
                explanation: "The identification problem means we need additional restrictions (recursive, long-run, or sign restrictions) to recover structural shocks from reduced-form innovations."
            },
            {
                question: "In Wooldridge's VECM framework, what role do the adjustment coefficients Œ± play?",
                options: [
                    "They measure long-run equilibrium relationships",
                    "They determine the speed of adjustment to equilibrium",
                    "They identify structural shocks",
                    "They test for unit roots"
                ],
                correct: 1,
                explanation: "In VECM, Œ± coefficients measure how quickly each variable adjusts when the system deviates from its long-run equilibrium (cointegrating) relationship."
            },
            {
                question: "According to Wooldridge, what information does variance decomposition provide in VAR analysis?",
                options: [
                    "The statistical significance of coefficients",
                    "The relative importance of different shocks at various horizons",
                    "The optimal lag length for the VAR",
                    "The presence of unit roots"
                ],
                correct: 1,
                explanation: "Variance decomposition shows what percentage of forecast error variance in each variable can be attributed to innovations in each variable, revealing relative importance over time."
            }
        ];

        // Navigation Functions
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        // VAR System Management
        function updateVARSystem() {
            const systemType = document.getElementById('varSystem').value;
            const system = varSystemDefinitions[systemType];
            
            document.getElementById('varText').innerHTML = `
                <h3 style="color: var(--secondary-red); margin-bottom: 18px;">${system.title}</h3>
                <p><strong>Economic Context:</strong> ${system.description}</p>
                <div class="wooldridge-note">
                    <p><strong>üéì Wooldridge VAR Methodology:</strong> ${system.wooldridgeNote}</p>
                </div>
                <p><strong>Variables:</strong> ${system.variables.join(', ')}</p>
                <p><strong>Identification:</strong> ${system.identification}</p>
                <p><strong>Data Frequency:</strong> ${system.frequency}</p>
                <p><strong>Data Source:</strong> ${system.source}</p>
            `;
            
            updateVAREquations();
        }

        function updateVAREquations() {
            const systemType = document.getElementById('varSystem').value;
            const system = varSystemDefinitions[systemType];
            const lags = parseInt(document.getElementById('varLags').value);
            
            // Update VAR equations display
            const equationsContainer = document.getElementById('varEquations');
            equationsContainer.innerHTML = '';
            
            system.variables.forEach((variable, index) => {
                const eqDiv = document.createElement('div');
                eqDiv.className = 'var-equation';
                eqDiv.textContent = `${variable}: ${lags} lags each var`;
                equationsContainer.appendChild(eqDiv);
            });
            
            if (currentVARSeries) {
                generateVARSeries();
            }
        }

        function updateVARLags() {
            updateVAREquations();
        }

        function updateShockDisplay() {
            const shockSize = document.getElementById('shockSize').value;
            document.getElementById('shockValue').textContent = `${shockSize} œÉ`;
            updateVAREquations();
        }

        // VAR Data Generation
        function generateVARSeries() {
            const systemType = document.getElementById('varSystem').value;
            const lags = parseInt(document.getElementById('varLags').value);
            const periods = parseInt(document.getElementById('samplePeriod').value);
            const shockSize = parseFloat(document.getElementById('shockSize').value);
            
            const system = varSystemDefinitions[systemType];
            
            // Generate VAR system data
            currentVARSeries = {
                type: systemType,
                lags: lags,
                periods: periods,
                shockSize: shockSize,
                system: system,
                data: []
            };

            // Generate sophisticated VAR system
            const startDate = new Date('1990-01-01');
            const numVars = system.variables.length;
            
            // Initialize data arrays
            let varData = Array(numVars).fill(null).map(() => []);
            
            for (let t = 0; t < periods; t++) {
                const date = new Date(startDate);
                date.setMonth(date.getMonth() + t * 3); // Quarterly
                
                let values = Array(numVars);
                
                for (let i = 0; i < numVars; i++) {
                    let value = 0;
                    
                    // Add autoregressive effects
                    for (let lag = 1; lag <= Math.min(lags, t); lag++) {
                        for (let j = 0; j < numVars; j++) {
                            const coefficient = 0.3 * Math.exp(-lag * 0.5) * (i === j ? 1.5 : 0.2);
                            value += coefficient * varData[j][t - lag];
                        }
                    }
                    
                    // Add innovation
                    const innovation = (Math.random() - 0.5) * shockSize * (1 + i * 0.2);
                    value += innovation;
                    
                    // Add variable-specific baseline
                    const baselines = systemType === 'monetary' ? [2.5, 2.0, 2.5, 0.75] :
                                    systemType === 'regional' ? [100, 90, 85, 95] :
                                    systemType === 'commodity' ? [60, 0.75, 2.0, 15000] :
                                    systemType === 'financial' ? [0.05, 2.5, 2.0, 1.0] :
                                    [62, 25, 1.5, 2.5]; // labor
                    
                    value += baselines[i];
                    
                    values[i] = value;
                    varData[i].push(value);
                }
                
                currentVARSeries.data.push({
                    period: t + 1,
                    date: date,
                    values: [...values],
                    innovations: values.map(() => (Math.random() - 0.5) * shockSize)
                });
            }

            updateVARChart();
        }

        // VAR Chart Updates
        function updateVARChart() {
            if (!currentVARSeries) return;
            
            const ctx = document.getElementById('varChart').getContext('2d');
            
            if (currentVARChart) {
                currentVARChart.destroy();
            }

            const labels = currentVARSeries.data.map(d => d.date.toISOString().substr(0, 7));
            const variables = currentVARSeries.system.variables;
            
            const datasets = variables.map((variable, index) => {
                const colors = ['#2E8B57', '#DC143C', '#40E0D0', '#D4AF37', '#6B46C1'];
                return {
                    label: variable,
                    data: currentVARSeries.data.map(d => d.values[index]),
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    pointRadius: 1,
                    tension: 0.2
                };
            });

            currentVARChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentVARSeries.system.title} - ${currentVARSeries.lags} Lag VAR`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Time Period' }
                        },
                        y: {
                            title: { display: true, text: 'Variable Values (normalized)' }
                        }
                    }
                }
            });
        }

        // VAR Estimation
        function estimateVAR() {
            if (!currentVARSeries) {
                alert('Please generate VAR series data first');
                return;
            }

            // Simplified VAR estimation
            const data = currentVARSeries.data;
            const n = data.length;
            const numVars = currentVARSeries.system.variables.length;
            
            // Calculate basic statistics for each variable
            let varStats = [];
            for (let i = 0; i < numVars; i++) {
                const values = data.map(d => d.values[i]);
                const mean = values.reduce((a,b) => a+b, 0) / n;
                const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (n-1);
                
                // Simple autoregression coefficient
                let autocorr = 0;
                if (n > 1) {
                    let num = 0, denom = 0;
                    for (let t = 1; t < n; t++) {
                        num += (values[t] - mean) * (values[t-1] - mean);
                        denom += Math.pow(values[t-1] - mean, 2);
                    }
                    autocorr = denom > 0 ? num / denom : 0;
                }
                
                varStats.push({ mean, variance, autocorr });
            }

            // Calculate cross-correlations (simplified)
            let crossCorrelations = [];
            for (let i = 0; i < numVars; i++) {
                for (let j = i + 1; j < numVars; j++) {
                    const valuesI = data.map(d => d.values[i]);
                    const valuesJ = data.map(d => d.values[j]);
                    const meanI = varStats[i].mean;
                    const meanJ = varStats[j].mean;
                    
                    let correlation = 0;
                    let numerator = 0, denominatorI = 0, denominatorJ = 0;
                    for (let t = 0; t < n; t++) {
                        numerator += (valuesI[t] - meanI) * (valuesJ[t] - meanJ);
                        denominatorI += Math.pow(valuesI[t] - meanI, 2);
                        denominatorJ += Math.pow(valuesJ[t] - meanJ, 2);
                    }
                    
                    if (denominatorI > 0 && denominatorJ > 0) {
                        correlation = numerator / Math.sqrt(denominatorI * denominatorJ);
                    }
                    
                    crossCorrelations.push({
                        variables: [i, j],
                        correlation: correlation
                    });
                }
            }

            displayVARResults({
                varStats,
                crossCorrelations,
                observations: n,
                variables: currentVARSeries.system.variables,
                lags: currentVARSeries.lags
            });
        }

        function displayVARResults(results) {
            // Update statistics display
            let statsHTML = '';
            results.variables.forEach((variable, index) => {
                const stats = results.varStats[index];
                statsHTML += `
                    <div class="stat-card">
                        <div class="stat-value">${stats.mean.toFixed(2)}</div>
                        <div class="stat-label">${variable} Mean</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Math.sqrt(stats.variance).toFixed(3)}</div>
                        <div class="stat-label">${variable} Std Dev</div>
                    </div>
                `;
            });

            document.getElementById('varStats').innerHTML = statsHTML;
        }

        // Granger Causality Testing
        function grangerCausalityTest() {
            if (!currentVARSeries) {
                alert('Please estimate VAR model first');
                return;
            }

            // Simplified Granger causality tests
            const variables = currentVARSeries.system.variables;
            const numVars = variables.length;
            
            // Generate simulated F-statistics for demonstration
            let grangerTests = [];
            for (let i = 0; i < numVars; i++) {
                for (let j = 0; j < numVars; j++) {
                    if (i !== j) {
                        // Simulated F-statistic (in practice, would be computed from restricted vs unrestricted models)
                        const fStat = Math.random() * 8 + 0.5; // Random F between 0.5 and 8.5
                        const criticalValue = 2.4; // Approximate F critical value
                        const significant = fStat > criticalValue;
                        
                        grangerTests.push({
                            from: variables[i],
                            to: variables[j],
                            fStatistic: fStat,
                            significant: significant
                        });
                    }
                }
            }

            displayGrangerResults(grangerTests);
        }

        function displayGrangerResults(tests) {
            let tableHTML = `
                <h4>üî¨ Granger Causality Test Results</h4>
                <div style="font-family: 'Source Code Pro', monospace; background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; font-weight: 600; border-bottom: 2px solid #ddd; padding-bottom: 12px;">
                        <div>From ‚Üí To</div>
                        <div>F-Statistic</div>
                        <div>Critical (5%)</div>
                        <div>Conclusion</div>
                    </div>
            `;

            tests.forEach(test => {
                const bgColor = test.significant ? 'rgba(46, 139, 87, 0.1)' : 'transparent';
                tableHTML += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; padding: 12px 0; background: ${bgColor};">
                        <div>${test.from} ‚Üí ${test.to}</div>
                        <div>${test.fStatistic.toFixed(3)}</div>
                        <div>2.40</div>
                        <div>${test.significant ? '‚úì Granger-causes' : '‚úó No causation'}</div>
                    </div>
                `;
            });

            tableHTML += `</div>`;

            const significantTests = tests.filter(t => t.significant);
            tableHTML += `
                <div class="granger-test">
                    <p><strong>üéì Wooldridge Interpretation:</strong> 
                    Found ${significantTests.length} significant Granger causality relationships out of ${tests.length} tested. 
                    This suggests ${significantTests.length > tests.length / 2 ? 'strong' : 'moderate'} dynamic interdependence in the system.</p>
                </div>
            `;

            document.getElementById('grangerTable').innerHTML = tableHTML;

            // Update impulse response analysis
            displayVarianceDecomposition();
            updateImpulseResponseChart();
        }

        function displayVarianceDecomposition() {
            // Simplified variance decomposition for demonstration
            const variables = currentVARSeries.system.variables;
            const numVars = variables.length;
            
            let decompositionHTML = `
                <h4>‚ö° Forecast Error Variance Decomposition</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin: 25px 0;">
            `;

            variables.forEach((variable, index) => {
                // Simulated variance shares (should sum to 100%)
                let shares = Array(numVars).fill(0).map(() => Math.random());
                const total = shares.reduce((a, b) => a + b, 0);
                shares = shares.map(s => (s / total * 100));

                decompositionHTML += `
                    <div class="stat-card">
                        <h5>${variable} (12 periods ahead)</h5>
                        ${variables.map((v, i) => 
                            `<p><strong>${v}:</strong> ${shares[i].toFixed(1)}%</p>`
                        ).join('')}
                    </div>
                `;
            });

            decompositionHTML += `</div>
                <div style="background: #F0F8FF; padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary-green);">
                    <p><strong>üéì Wooldridge Policy Insight:</strong> 
                    Variance decomposition reveals the relative importance of different shocks. 
                    Variables explaining large shares of others' forecast errors are key drivers of system dynamics.</p>
                </div>
            `;

            document.getElementById('varianceResults').innerHTML = decompositionHTML;
        }

        function updateImpulseResponseChart() {
            const ctx = document.getElementById('impulseChart').getContext('2d');
            
            if (impulseChart) {
                impulseChart.destroy();
            }

            // Generate simulated impulse response functions
            const periods = 20;
            const variables = currentVARSeries.system.variables;
            const shockVar = variables[0]; // Shock to first variable

            const datasets = variables.map((variable, index) => {
                const colors = ['#2E8B57', '#DC143C', '#40E0D0', '#D4AF37'];
                let response = [];
                
                for (let h = 0; h < periods; h++) {
                    // Simulated impulse response (should decay over time)
                    const decay = Math.exp(-h * 0.15);
                    const magnitude = index === 0 ? 1 : Math.random() * 0.8;
                    const value = magnitude * decay * (1 + 0.3 * Math.sin(h * 0.3));
                    response.push(value);
                }
                
                return {
                    label: `${shockVar} ‚Üí ${variable}`,
                    data: response,
                    borderColor: colors[index],
                    backgroundColor: 'transparent',
                    borderWidth: 2,
                    pointRadius: 3
                };
            });

            impulseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: periods}, (_, i) => i),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Impulse Responses to ${shockVar} Shock`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Periods After Shock' }
                        },
                        y: {
                            title: { display: true, text: 'Response Magnitude' }
                        }
                    }
                }
            });
        }

        // Assessment Functions
        function generateNewQuestion() {
            currentQuestion = assessmentQuestions[Math.floor(Math.random() * assessmentQuestions.length)];
            selectedAnswer = null;
            
            document.querySelector('.decision-question').textContent = currentQuestion.question;
            
            const optionsContainer = document.getElementById('assessmentOptions');
            optionsContainer.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'decision-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('assessmentFeedback').innerHTML = '';
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            
            document.querySelectorAll('.decision-option').forEach((option, index) => {
                option.classList.toggle('selected', index === answerIndex);
            });
        }

        function checkAnswer() {
            if (selectedAnswer === null) {
                alert('Please select an answer first');
                return;
            }
            
            const isCorrect = selectedAnswer === currentQuestion.correct;
            const feedbackClass = isCorrect ? 'feedback-success' : 'feedback-danger';
            const feedbackTitle = isCorrect ? '‚úì Correct!' : '‚úó Incorrect';
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="${feedbackClass}">
                    <h4>${feedbackTitle}</h4>
                    <p><strong>Explanation:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                </div>
            `;
        }

        function showExpertSolution() {
            if (!currentQuestion) {
                generateNewQuestion();
                return;
            }
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="feedback-success">
                    <h4>üéì Expert Solution</h4>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                    <p><strong>Wooldridge Insight:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Advanced Mastery:</strong> Chapter 18 represents the pinnacle of undergraduate time series econometrics, providing tools for sophisticated policy analysis and economic research at the graduate level.</p>
                </div>
            `;
        }

        // Initialize page
        window.addEventListener('load', function() {
            updateVARSystem();
            generateNewQuestion();
        });
    </script>
</body>
</html>
