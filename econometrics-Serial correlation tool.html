<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wooldridge Ch. 12: Serial Correlation & Heteroskedasticity in TS</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Source+Code+Pro:wght@400;500;600&family=Lato:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        :root {
            --primary-green: #2E8B57;
            --secondary-red: #DC143C;
            --academic-navy: #2C3E50;
            --light-green: #90EE90;
            --turquoise: #40E0D0;
            --neutral-lightgray: #F5F5F5;
            --background-cream: #FAFAFA;
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #DC143C;
            --deep-blue: #1E3A8A;
            --correction-purple: #8B5CF6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, var(--background-cream) 0%, #F0F8FF 50%, #F5F5F5 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Sophisticated background pattern */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(46, 139, 87, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(64, 224, 208, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(44, 62, 80, 0.02) 0%, transparent 50%),
                radial-gradient(circle at 70% 20%, rgba(139, 92, 246, 0.02) 0%, transparent 40%);
            animation: seriesFlow 25s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes seriesFlow {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.05); }
            50% { transform: rotate(180deg) scale(0.95); }
            75% { transform: rotate(270deg) scale(1.02); }
        }

        .container {
            max-width: 1700px;
            margin: 25px auto;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 80px rgba(44, 62, 80, 0.15);
            border-radius: 30px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: containerEntry 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes containerEntry {
            from {
                opacity: 0;
                transform: scale(0.94) translateY(40px);
                filter: blur(8px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
                filter: blur(0);
            }
        }

        /* Header Design - Navy Background */
        .header-section {
            background: linear-gradient(135deg, var(--academic-navy) 0%, #34495e 50%, #2c3e50 100%);
            color: white;
            padding: 50px 40px;
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                transparent 0%, 
                rgba(64, 224, 208, 0.1) 25%, 
                transparent 50%, 
                rgba(139, 92, 246, 0.08) 75%, 
                transparent 100%);
            animation: correctionFlow 9s ease-in-out infinite;
        }

        @keyframes correctionFlow {
            0%, 100% { transform: translateX(-120px) scaleX(1) skewX(0deg); opacity: 0.6; }
            50% { transform: translateX(120px) scaleX(1.3) skewX(15deg); opacity: 0.9; }
        }

        .header-title {
            font-family: 'Crimson Text', serif;
            font-size: 3.4em;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 4px 8px rgba(0,0,0,0.4);
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, white 0%, #E2E8F0 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 1.5em;
            font-weight: 300;
            opacity: 0.92;
            position: relative;
            z-index: 2;
        }

        /* Navigation - Green Theme */
        .nav-tabs {
            display: flex;
            background: linear-gradient(90deg, var(--primary-green) 0%, #3CB371 100%);
            padding: 0;
            position: relative;
            overflow: hidden;
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 25%;
            background: rgba(255,255,255,0.1);
            transform: translateX(-100%);
            animation: navCorrection 7s ease-in-out infinite;
        }

        @keyframes navCorrection {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(400%); }
        }

        .tab-button {
            flex: 1;
            padding: 25px;
            background: none;
            border: none;
            color: white;
            font-weight: 500;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 4px solid transparent;
            position: relative;
            z-index: 2;
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .tab-button.active {
            background: rgba(255,255,255,0.2);
            border-bottom-color: var(--turquoise);
            font-weight: 600;
            box-shadow: inset 0 -4px 0 var(--turquoise);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 50px;
            animation: contentSlide 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-section.active {
            display: block;
        }

        @keyframes contentSlide {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Section Titles - RED */
        .section-title {
            font-family: 'Crimson Text', serif;
            font-size: 3em;
            color: var(--secondary-red);
            margin-bottom: 40px;
            text-align: center;
            font-weight: 700;
            position: relative;
            text-shadow: 1px 2px 4px rgba(0,0,0,0.1);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 3px;
            background: linear-gradient(90deg, var(--turquoise) 0%, var(--primary-green) 100%);
            border-radius: 2px;
            animation: titlePulse 2s ease-in-out infinite alternate;
        }

        @keyframes titlePulse {
            from { width: 120px; }
            to { width: 160px; }
        }

        /* Theory Framework */
        .theory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 35px;
            margin-bottom: 45px;
        }

        .theory-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%);
            padding: 40px;
            border-radius: 20px;
            border-left: 6px solid var(--turquoise);
            box-shadow: 0 12px 32px rgba(44, 62, 80, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .theory-card::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(64, 224, 208, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: cardCorrection 5s ease-in-out infinite;
        }

        @keyframes cardCorrection {
            0%, 100% { 
                transform: scale(1) translateX(0) translateY(0); 
                opacity: 0.5; 
            }
            50% { 
                transform: scale(1.4) translateX(15px) translateY(-15px); 
                opacity: 0.8; 
            }
        }

        .theory-card:hover {
            transform: translateY(-12px) rotateX(5deg);
            box-shadow: 0 20px 50px rgba(44, 62, 80, 0.15);
            border-left-color: var(--correction-purple);
        }

        .theory-card h3 {
            font-family: 'Crimson Text', serif;
            color: var(--secondary-red);
            margin-bottom: 20px;
            font-size: 1.7em;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .theory-card p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 16px;
            position: relative;
            z-index: 2;
        }

        /* Mathematical Equations */
        .equation-display {
            background: linear-gradient(135deg, var(--academic-navy) 0%, var(--deep-blue) 100%);
            color: white;
            padding: 32px;
            border-radius: 15px;
            margin: 25px 0;
            font-family: 'Source Code Pro', monospace;
            font-size: 1.2em;
            box-shadow: inset 0 2px 15px rgba(0,0,0,0.3), 0 8px 25px rgba(44, 62, 80, 0.2);
            overflow-x: auto;
            border: 2px solid rgba(64, 224, 208, 0.3);
            position: relative;
        }

        .equation-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, var(--turquoise) 50%, transparent 100%);
            animation: equationCorrection 4s ease-in-out infinite;
        }

        @keyframes equationCorrection {
            0%, 100% { opacity: 0.3; transform: scaleX(0.7); }
            50% { opacity: 1; transform: scaleX(1.3); }
        }

        /* Interactive Controls */
        .control-panel {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 50%, #F8FAFC 100%);
            padding: 40px;
            border-radius: 25px;
            margin: 40px 0;
            border: 3px solid var(--turquoise);
            box-shadow: 0 15px 35px rgba(64, 224, 208, 0.15);
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: -60%;
            left: -60%;
            width: 220%;
            height: 220%;
            background: conic-gradient(from 45deg, 
                transparent 0%, 
                rgba(64, 224, 208, 0.04) 20%, 
                transparent 40%, 
                rgba(139, 92, 246, 0.03) 60%, 
                transparent 80%, 
                rgba(46, 139, 87, 0.02) 100%);
            animation: controlCorrection 14s linear infinite;
        }

        @keyframes controlCorrection {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .control-header {
            font-family: 'Crimson Text', serif;
            color: var(--secondary-red);
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 35px;
            position: relative;
            z-index: 2;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-size: 1.1em;
        }

        .form-group select,
        .form-group input {
            padding: 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 1.1em;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--turquoise);
            box-shadow: 0 0 20px rgba(64, 224, 208, 0.3);
            transform: translateY(-3px) scale(1.02);
        }

        /* Action Buttons - Green/Navy Theme */
        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 35px;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .btn {
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green) 0%, #3CB371 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(46, 139, 87, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3CB371 0%, var(--primary-green) 100%);
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(46, 139, 87, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-red) 0%, #EF4444 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #EF4444 0%, var(--secondary-red) 100%);
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(220, 20, 60, 0.4);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--correction-purple) 0%, #7C3AED 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }

        .btn-accent:hover {
            background: linear-gradient(135deg, #7C3AED 0%, var(--correction-purple) 100%);
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(139, 92, 246, 0.4);
        }

        /* Results Display */
        .results-container {
            background: white;
            border: 3px solid var(--primary-green);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .results-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--turquoise) 0%, var(--correction-purple) 25%, var(--primary-green) 50%, var(--correction-purple) 75%, var(--turquoise) 100%);
            animation: resultsBorder 3s ease-in-out infinite;
        }

        @keyframes resultsBorder {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .results-header {
            font-family: 'Crimson Text', serif;
            font-size: 2.2em;
            color: var(--secondary-red);
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 500px;
            margin: 40px 0;
            background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid var(--light-green);
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 30px;
            margin: 35px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #E2E8F0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--turquoise) 0%, var(--correction-purple) 50%, var(--primary-green) 100%);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-value {
            font-family: 'Source Code Pro', monospace;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Correction Specific Elements */
        .correction-info {
            background: linear-gradient(135deg, #F3E8FF 0%, #FAF5FF 100%);
            border: 2px solid var(--correction-purple);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .correction-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .correction-step {
            background: var(--correction-purple);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9em;
        }

        /* Decision Framework */
        .decision-panel {
            background: linear-gradient(135deg, #F0FFF0 0%, var(--light-green) 100%);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            padding: 35px;
            margin: 35px 0;
        }

        .decision-question {
            font-family: 'Crimson Text', serif;
            font-weight: 600;
            font-size: 1.4em;
            margin-bottom: 25px;
            color: var(--academic-navy);
            text-align: center;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .decision-option {
            padding: 20px;
            background: white;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }

        .decision-option:hover {
            border-color: var(--turquoise);
            background: #F0FFFF;
            transform: translateY(-4px);
        }

        .decision-option.selected {
            border-color: var(--primary-green);
            background: #F0FFF0;
            box-shadow: 0 0 20px rgba(46, 139, 87, 0.2);
        }

        /* Feedback Messages */
        .feedback-message {
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            font-weight: 500;
            font-size: 1.1em;
        }

        .feedback-success {
            background: #F0FFF0;
            border: 2px solid var(--primary-green);
            color: #0D4A22;
        }

        .feedback-warning {
            background: #FFF8E1;
            border: 2px solid var(--warning);
            color: #8B4513;
        }

        .feedback-danger {
            background: #FFE4E6;
            border: 2px solid var(--secondary-red);
            color: #721c24;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 15px;
                border-radius: 20px;
            }

            .header-title {
                font-size: 2.4em;
            }

            .theory-grid {
                grid-template-columns: 1fr;
            }

            .control-group {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Wooldridge References */
        .wooldridge-note {
            background: #F0F8FF;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid var(--primary-green);
            font-style: italic;
            position: relative;
        }

        .wooldridge-note::before {
            content: 'üìö';
            position: absolute;
            top: 25px;
            left: 20px;
            font-size: 1.2em;
        }

        .wooldridge-note p {
            margin-left: 30px;
        }

        /* Enhanced Visual Effects */
        .correction-highlight {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid var(--correction-purple);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .dw-statistic {
            display: inline-block;
            background: linear-gradient(135deg, var(--warning) 0%, #FCD34D 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-family: 'Source Code Pro', monospace;
            font-weight: 600;
            margin: 0 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="header-title">Wooldridge Ch. 12: Serial Correlation & Heteroskedasticity</h1>
            <p class="header-subtitle">FGLS, Prais-Winsten & Robust Inference in Time Series</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-button active" onclick="showSection('theory')">üîß Correction Methods</button>
            <button class="tab-button" onclick="showSection('simulation')">üìà FGLS & Prais-Winsten</button>
            <button class="tab-button" onclick="showSection('analysis')">üéØ Diagnostic Testing</button>
            <button class="tab-button" onclick="showSection('assessment')">‚úÖ Assessment Mode</button>
        </div>

        <!-- Theory Framework Section -->
        <div id="theory" class="content-section active">
            <h2 class="section-title">Wooldridge Ch. 12 Correction Framework</h2>
            
            <div class="theory-grid">
                <div class="theory-card">
                    <h3>üîç Serial Correlation Detection</h3>
                    <p><strong>Wooldridge Tests:</strong> Multiple approaches to detect AR(1) errors in time series regression</p>
                    <div class="equation-display">
                        Durbin-Watson: DW = Œ£(e‚Çú - e‚Çú‚Çã‚ÇÅ)¬≤ / Œ£e‚Çú¬≤<br>
                        LM Test: T¬∑R¬≤ ~ œá¬≤‚ÇÅ under H‚ÇÄ: œÅ = 0
                    </div>
                    <p><em>DW ‚âà 2(1-œÅÃÇ), with critical values at 1.5-2.5 range</em></p>
                    <div class="correction-highlight">
                        <strong>Rule of thumb:</strong> DW < 1.5 suggests positive serial correlation
                    </div>
                </div>

                <div class="theory-card">
                    <h3>‚ö° Feasible GLS (FGLS)</h3>
                    <p><strong>Wooldridge FGLS Procedure:</strong> Two-step method to correct for known error structure</p>
                    <div class="equation-display">
                        Step 1: OLS ‚Üí √™‚ÇÅ, √™‚ÇÇ, ..., √™‚Çú<br>
                        Step 2: œÅÃÇ = Œ£√™‚Çú√™‚Çú‚Çã‚ÇÅ / Œ£√™¬≤‚Çú‚Çã‚ÇÅ<br>
                        Step 3: GLS with Œ©ÃÇ using œÅÃÇ
                    </div>
                    <p><strong>Efficiency gain:</strong> FGLS more efficient than OLS when Œ© known</p>
                </div>

                <div class="theory-card">
                    <h3>üîÑ Prais-Winsten Transformation</h3>
                    <p><strong>AR(1) Error Correction:</strong> Transform to remove serial correlation</p>
                    <div class="equation-display">
                        Original: y‚Çú = X‚ÇúŒ≤ + u‚Çú, u‚Çú = œÅu‚Çú‚Çã‚ÇÅ + Œµ‚Çú<br>
                        Transform: y‚Çú - œÅy‚Çú‚Çã‚ÇÅ = (X‚Çú - œÅX‚Çú‚Çã‚ÇÅ)Œ≤ + Œµ‚Çú<br>
                        First obs: ‚àö(1-œÅ¬≤)y‚ÇÅ = ‚àö(1-œÅ¬≤)X‚ÇÅŒ≤ + ‚àö(1-œÅ¬≤)u‚ÇÅ
                    </div>
                    <p><em>Preserves first observation unlike Cochrane-Orcutt</em></p>
                </div>

                <div class="theory-card">
                    <h3>üìä Cochrane-Orcutt Procedure</h3>
                    <p><strong>Iterative AR(1) Correction:</strong> Simpler but loses first observation</p>
                    <div class="equation-display">
                        ≈∑‚Çú = y‚Çú - œÅÃÇy‚Çú‚Çã‚ÇÅ, XÃÇ‚Çú = X‚Çú - œÅÃÇX‚Çú‚Çã‚ÇÅ<br>
                        Iterate: œÅÃÇ‚Åø‚Å∫¬π until convergence<br>
                        Final: OLS on (≈∑‚Çú, XÃÇ‚Çú) for t = 2, ..., T
                    </div>
                    <p><strong>Convergence:</strong> Usually 2-3 iterations sufficient</p>
                </div>

                <div class="theory-card">
                    <h3>‚öñÔ∏è Heteroskedasticity in Time Series</h3>
                    <p><strong>Time-Varying Variance:</strong> Volatility changes over time periods</p>
                    <div class="equation-display">
                        Var(u‚Çú|X‚Çú) = œÉ¬≤‚Çú = exp(Œ¥‚ÇÄ + Œ¥‚ÇÅz‚Çú‚ÇÅ + Œ¥‚ÇÇz‚Çú‚ÇÇ + ...)<br>
                        White Test: T¬∑R¬≤ ~ œá¬≤‚Çñ from u¬≤‚Çú regression
                    </div>
                    <p><strong>Applications:</strong> Financial volatility, policy regimes, structural breaks</p>
                </div>

                <div class="theory-card">
                    <h3>üõ°Ô∏è Robust Inference</h3>
                    <p><strong>Wooldridge HAC Estimators:</strong> Valid inference under serial correlation and heteroskedasticity</p>
                    <div class="equation-display">
                        Newey-West: VÃÇ = (X'X)‚Åª¬π[Œ£ + Œ£w‚±º(Œì‚±º + Œì'‚±º)](X'X)‚Åª¬π<br>
                        Weights: w‚±º = 1 - j/(L+1)
                    </div>
                    <p><strong>Lag selection:</strong> L = floor(4(T/100)^(2/9)) automatic choice</p>
                </div>
            </div>

            <div class="theory-card" style="grid-column: 1 / -1;">
                <h3>üá®üá¶ Canadian Policy Transmission Applications</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 25px;">
                    <div>
                        <h4>üè¶ Bank of Canada Transmission:</h4>
                        <ul>
                            <li><strong>Interest Rate Pass-through:</strong> Policy rate to lending rates</li>
                            <li><strong>Exchange Rate Channel:</strong> CAD response to rate changes</li>
                            <li><strong>Asset Price Effects:</strong> TSX and housing price transmission</li>
                            <li><strong>Credit Channel:</strong> Bank lending behavior persistence</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üìà Macroeconomic Persistence:</h4>
                        <ul>
                            <li><strong>Inflation Dynamics:</strong> CPI persistence and expectations</li>
                            <li><strong>Employment Hysteresis:</strong> Unemployment rate persistence</li>
                            <li><strong>Commodity Price Transmission:</strong> Oil price effects on GDP</li>
                            <li><strong>Regional Spillovers:</strong> Provincial economic interdependence</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="wooldridge-note">
                <p><strong>üéì Wooldridge Chapter 12 Key Insight:</strong> Serial correlation and heteroskedasticity in time series require specialized correction methods. FGLS and Prais-Winsten provide efficiency gains when error structure is known, while robust methods ensure valid inference when it's not.</p>
            </div>
        </div>

        <!-- Interactive Simulation Section -->
        <div id="simulation" class="content-section">
            <h2 class="section-title">FGLS & Correction Procedures</h2>

            <div class="control-panel">
                <h3 class="control-header">üîß Serial Correlation Correction Simulation</h3>
                
                <div class="control-group">
                    <div class="form-group">
                        <label for="correctionSeries">Canadian Economic Series</label>
                        <select id="correctionSeries" onchange="updateCorrectionSeries()">
                            <option value="policy">Bank of Canada Policy Transmission</option>
                            <option value="inflation">CPI Inflation Persistence</option>
                            <option value="employment">Employment Rate Dynamics</option>
                            <option value="exchange">CAD/USD Policy Response</option>
                            <option value="housing">Housing Price Momentum</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="correctionMethod">Correction Method</label>
                        <select id="correctionMethod" onchange="updateCorrectionMethod()">
                            <option value="ols">OLS (Uncorrected)</option>
                            <option value="fgls">Feasible GLS</option>
                            <option value="prais">Prais-Winsten</option>
                            <option value="cochrane">Cochrane-Orcutt</option>
                            <option value="robust">HAC/Newey-West</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="seriesLength">Sample Period</label>
                        <select id="seriesLength">
                            <option value="80">Short (20 years, quarterly)</option>
                            <option value="120" selected>Medium (30 years, quarterly)</option>
                            <option value="160">Long (40 years, quarterly)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="serialCorrelation">Serial Correlation (œÅ)</label>
                        <input type="range" id="serialCorrelation" min="0" max="0.9" step="0.1" value="0.5" onchange="updateRhoDisplay()">
                        <span id="rhoValue">0.5</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="generateCorrectionSeries()">üé≤ Generate Series</button>
                    <button class="btn btn-secondary" onclick="estimateCorrectionModel()">üîç Apply Correction</button>
                    <button class="btn btn-accent" onclick="compareMethods()">‚öñÔ∏è Compare Methods</button>
                </div>
            </div>

            <!-- Current Model Display -->
            <div id="correctionDescription" class="correction-info">
                <div class="results-header">Current Correction Procedure</div>
                <div id="correctionText"></div>
                <div id="correctionSteps" class="correction-steps"></div>
            </div>

            <!-- Correction Chart -->
            <div class="chart-container">
                <canvas id="correctionChart"></canvas>
            </div>
        </div>

        <!-- Diagnostic Testing Section -->
        <div id="analysis" class="content-section">
            <h2 class="section-title">Diagnostic Testing Results</h2>

            <div id="diagnosticResults" class="results-container">
                <div class="results-header">Serial Correlation Tests</div>
                <div id="diagnosticTable"></div>
            </div>

            <div class="stats-grid" id="correctionStats">
                <!-- Dynamic statistics will be populated here -->
            </div>

            <div id="efficiencyGains" class="results-container">
                <div class="results-header">üéØ Efficiency Analysis</div>
                <div id="efficiencyResults"></div>
            </div>

            <!-- Comparison Chart -->
            <div class="chart-container">
                <h3 style="text-align: center; margin-bottom: 25px; color: var(--secondary-red);">üìä Method Comparison</h3>
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>

        <!-- Assessment Mode Section -->
        <div id="assessment" class="content-section">
            <h2 class="section-title">Correction Assessment Challenge</h2>

            <div id="assessmentQuestion" class="decision-panel">
                <div class="decision-question">Loading serial correlation assessment...</div>
                <div class="decision-options" id="assessmentOptions">
                    <!-- Dynamic options will be populated -->
                </div>
                <button class="btn btn-primary" onclick="checkAnswer()" style="margin-top: 30px;">Submit Answer</button>
            </div>

            <div id="assessmentFeedback"></div>

            <div class="button-group" style="margin-top: 40px;">
                <button class="btn btn-secondary" onclick="generateNewQuestion()">üìù New Question</button>
                <button class="btn btn-accent" onclick="showExpertSolution()">üéì Show Expert Solution</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentCorrectionSeries = null;
        let currentCorrectionChart = null;
        let comparisonChart = null;
        let selectedAnswer = null;
        let currentQuestion = null;

        // Serial Correction Series Definitions
        const correctionSeriesDefinitions = {
            policy: {
                title: "Bank of Canada Policy Transmission",
                description: "Wooldridge-style analysis of how Bank of Canada overnight rate changes transmit to long-term lending rates. Demonstrates classic serial correlation in financial transmission mechanisms.",
                variable: "5-Year Government Bond Yield (%)",
                equation: "yield_t = Œ± + Œ≤‚ÇÅpolicy_t + Œ≤‚ÇÇyield_{t-1} + u_t, u_t = œÅu_{t-1} + Œµ_t",
                baseline: 2.5,
                volatility: 0.4,
                serialCorrelation: 0.7,
                wooldridgeNote: "Policy transmission shows high persistence requiring FGLS correction",
                frequency: "Monthly",
                source: "Bank of Canada, Government Bond Yields"
            },
            inflation: {
                title: "CPI Inflation Persistence Analysis",
                description: "Canadian CPI inflation dynamics with adaptive expectations. Shows how past inflation affects current inflation - classic AR(1) behavior requiring Prais-Winsten correction.",
                variable: "CPI Inflation Rate (%)",
                equation: "œÄ_t = Œ± + Œ≤‚ÇÅœÄ^e_t + Œ≤‚ÇÇgap_t + u_t, u_t = œÅu_{t-1} + Œµ_t",
                baseline: 2.0,
                volatility: 0.8,
                serialCorrelation: 0.6,
                wooldridgeNote: "Inflation expectations create persistent errors requiring correction",
                frequency: "Monthly",
                source: "Statistics Canada, Consumer Price Index"
            },
            employment: {
                title: "Employment Rate Hysteresis",
                description: "Provincial employment rate analysis showing hysteresis effects. Past unemployment affects current employment capacity through skill loss and discouraged workers.",
                variable: "Employment Rate (%)",
                equation: "emp_t = Œ± + Œ≤‚ÇÅgdp_t + Œ≤‚ÇÇemp_{t-1} + u_t, u_t = œÅu_{t-1} + Œµ_t",
                baseline: 62.0,
                volatility: 1.5,
                serialCorrelation: 0.8,
                wooldridgeNote: "Labor market hysteresis creates strong AR(1) errors",
                frequency: "Monthly",
                source: "Statistics Canada, Labour Force Survey"
            },
            exchange: {
                title: "CAD/USD Policy Response",
                description: "Exchange rate response to Bank of Canada policy changes. Central bank interventions create persistent effects requiring robust inference methods.",
                variable: "CAD/USD Exchange Rate",
                equation: "cad_t = Œ± + Œ≤‚ÇÅrate_t + Œ≤‚ÇÇoil_t + u_t, u_t = œÅu_{t-1} + Œµ_t",
                baseline: 0.75,
                volatility: 0.05,
                serialCorrelation: 0.4,
                wooldridgeNote: "Exchange rate interventions create moderate serial correlation",
                frequency: "Daily",
                source: "Bank of Canada, Exchange Rates"
            },
            housing: {
                title: "Housing Price Momentum",
                description: "Canadian housing price changes with momentum and mean reversion. Speculative bubbles create complex serial correlation requiring advanced correction methods.",
                variable: "Housing Price Change (%)",
                equation: "Œîp_t = Œ± + Œ≤‚ÇÅincome_t + Œ≤‚ÇÇrate_t + u_t, u_t = œÅu_{t-1} + Œµ_t",
                baseline: 0.5,
                volatility: 2.0,
                serialCorrelation: 0.5,
                wooldridgeNote: "Housing momentum creates moderate persistence requiring FGLS",
                frequency: "Monthly",
                source: "Canadian Real Estate Association"
            }
        };

        // Assessment Questions (Wooldridge Ch. 12 focused)
        const assessmentQuestions = [
            {
                question: "According to Wooldridge, what is the main advantage of Prais-Winsten over Cochrane-Orcutt?",
                options: [
                    "Prais-Winsten converges faster",
                    "Prais-Winsten preserves the first observation",
                    "Prais-Winsten handles heteroskedasticity",
                    "Prais-Winsten is computationally simpler"
                ],
                correct: 1,
                explanation: "Wooldridge shows that Prais-Winsten preserves the first observation by using the transformation ‚àö(1-œÅ¬≤)y‚ÇÅ, while Cochrane-Orcutt discards it."
            },
            {
                question: "In Wooldridge's FGLS procedure, what happens when the error structure is misspecified?",
                options: [
                    "FGLS becomes inconsistent",
                    "FGLS loses efficiency but remains consistent",
                    "Standard errors become invalid",
                    "The procedure fails to converge"
                ],
                correct: 1,
                explanation: "Even with misspecified error structure, FGLS remains consistent but may lose efficiency relative to correctly specified GLS."
            },
            {
                question: "What does a Durbin-Watson statistic of 1.2 suggest according to Wooldridge?",
                options: [
                    "No serial correlation",
                    "Positive serial correlation",
                    "Negative serial correlation",
                    "Heteroskedasticity"
                ],
                correct: 1,
                explanation: "DW ‚âà 2(1-œÅ), so DW = 1.2 implies œÅ ‚âà 0.4, indicating positive serial correlation since DW < 1.5."
            },
            {
                question: "According to Wooldridge, when should you use HAC standard errors instead of FGLS?",
                options: [
                    "When sample size is small",
                    "When error structure is unknown or complex",
                    "When variables are trending",
                    "When R-squared is low"
                ],
                correct: 1,
                explanation: "HAC standard errors are robust to unknown forms of serial correlation and heteroskedasticity, while FGLS requires knowing the error structure."
            },
            {
                question: "In Wooldridge's framework, what is the key assumption for FGLS efficiency gains?",
                options: [
                    "Errors are normally distributed",
                    "Error structure Œ© is correctly specified",
                    "Sample size is large",
                    "Variables are stationary"
                ],
                correct: 1,
                explanation: "FGLS is more efficient than OLS only when the error covariance matrix Œ© is correctly specified. Misspecification eliminates efficiency gains."
            }
        ];

        // Navigation Functions
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        // Correction Series Management
        function updateCorrectionSeries() {
            const seriesType = document.getElementById('correctionSeries').value;
            const series = correctionSeriesDefinitions[seriesType];
            
            document.getElementById('correctionText').innerHTML = `
                <h3 style="color: var(--secondary-red); margin-bottom: 15px;">${series.title}</h3>
                <p><strong>Economic Context:</strong> ${series.description}</p>
                <div class="wooldridge-note">
                    <p><strong>üéì Wooldridge Correction Methodology:</strong> ${series.wooldridgeNote}</p>
                </div>
                <p><strong>Model Equation:</strong> <code>${series.equation}</code></p>
                <p><strong>Dependent Variable:</strong> ${series.variable}</p>
                <p><strong>Data Frequency:</strong> ${series.frequency}</p>
                <p><strong>Expected Serial Correlation:</strong> œÅ ‚âà ${series.serialCorrelation}</p>
                <p><strong>Data Source:</strong> ${series.source}</p>
            `;
            
            updateCorrectionMethod();
        }

        function updateCorrectionMethod() {
            const methodType = document.getElementById('correctionMethod').value;
            
            // Update correction steps display
            const stepsContainer = document.getElementById('correctionSteps');
            stepsContainer.innerHTML = '';
            
            let steps = [];
            switch(methodType) {
                case 'ols':
                    steps = ['Standard OLS', 'No Correction', 'Biased SE'];
                    break;
                case 'fgls':
                    steps = ['Step 1: OLS', 'Step 2: œÅÃÇ Estimation', 'Step 3: GLS Transform', 'Final: FGLS'];
                    break;
                case 'prais':
                    steps = ['Estimate œÅ', 'Transform All Obs', 'Preserve y‚ÇÅ', 'Final Regression'];
                    break;
                case 'cochrane':
                    steps = ['Initial œÅÃÇ', 'Drop y‚ÇÅ', 'Iterate', 'Converge'];
                    break;
                case 'robust':
                    steps = ['OLS Estimates', 'Newey-West SE', 'HAC Correction'];
                    break;
            }
            
            steps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'correction-step';
                stepDiv.textContent = step;
                stepsContainer.appendChild(stepDiv);
            });
            
            if (currentCorrectionSeries) {
                generateCorrectionSeries();
            }
        }

        function updateRhoDisplay() {
            const rho = document.getElementById('serialCorrelation').value;
            document.getElementById('rhoValue').textContent = rho;
            updateCorrectionMethod();
        }

        // Data Generation with Serial Correlation
        function generateCorrectionSeries() {
            const seriesType = document.getElementById('correctionSeries').value;
            const methodType = document.getElementById('correctionMethod').value;
            const periods = parseInt(document.getElementById('seriesLength').value);
            const rho = parseFloat(document.getElementById('serialCorrelation').value);
            
            const series = correctionSeriesDefinitions[seriesType];
            
            // Generate time series with AR(1) errors
            currentCorrectionSeries = {
                type: seriesType,
                method: methodType,
                periods: periods,
                rho: rho,
                series: series,
                data: []
            };

            // Generate dates (quarterly data starting 1990)
            const startDate = new Date('1990-01-01');
            
            // Generate underlying series with AR(1) errors
            let previousError = 0;
            
            for (let t = 0; t < periods; t++) {
                const date = new Date(startDate);
                date.setMonth(date.getMonth() + t * 3); // Quarterly
                
                // Generate explanatory variable (e.g., policy rate)
                const x = 1.5 + 0.5 * Math.sin(t * 0.1) + 0.3 * (Math.random() - 0.5);
                
                // True relationship
                let trueY = series.baseline + 0.8 * x;
                
                // AR(1) error
                const innovation = (Math.random() - 0.5) * series.volatility;
                const error = rho * previousError + innovation;
                previousError = error;
                
                // Observed y with serially correlated errors
                const observedY = trueY + error;
                
                currentCorrectionSeries.data.push({
                    period: t + 1,
                    date: date,
                    x: x,
                    trueY: trueY,
                    observedY: observedY,
                    error: error,
                    innovation: innovation
                });
            }

            updateCorrectionChart();
        }

        // Chart Updates
        function updateCorrectionChart() {
            if (!currentCorrectionSeries) return;
            
            const ctx = document.getElementById('correctionChart').getContext('2d');
            
            if (currentCorrectionChart) {
                currentCorrectionChart.destroy();
            }

            const labels = currentCorrectionSeries.data.map(d => d.date.toISOString().substr(0, 7));
            const observedData = currentCorrectionSeries.data.map(d => d.observedY);
            const trueData = currentCorrectionSeries.data.map(d => d.trueY);
            const errorData = currentCorrectionSeries.data.map(d => d.error);

            currentCorrectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Observed Series (with AR errors)',
                        data: observedData,
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        borderWidth: 2,
                        pointRadius: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'True Series (no errors)',
                        data: trueData,
                        borderColor: '#40E0D0',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [4, 4],
                        pointRadius: 0,
                        yAxisID: 'y'
                    }, {
                        label: 'AR(1) Errors',
                        data: errorData,
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 1,
                        pointRadius: 0,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentCorrectionSeries.series.title} - Serial Correlation œÅ=${currentCorrectionSeries.rho}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Time Period' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: currentCorrectionSeries.series.variable }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Error Terms' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // Model Estimation with Correction
        function estimateCorrectionModel() {
            if (!currentCorrectionSeries) {
                alert('Please generate correction series data first');
                return;
            }

            // Simplified correction estimation
            const data = currentCorrectionSeries.data;
            const y = data.map(d => d.observedY);
            const x = data.map(d => d.x);
            const n = y.length;
            
            // OLS estimation
            const meanY = y.reduce((a,b) => a+b, 0) / n;
            const meanX = x.reduce((a,b) => a+b, 0) / n;
            
            let numerator = 0, denominator = 0;
            for (let i = 0; i < n; i++) {
                numerator += (x[i] - meanX) * (y[i] - meanY);
                denominator += (x[i] - meanX) * (x[i] - meanX);
            }
            
            const betaOLS = numerator / denominator;
            const alphaOLS = meanY - betaOLS * meanX;
            
            // Calculate residuals
            const residuals = y.map((yi, i) => yi - (alphaOLS + betaOLS * x[i]));
            const rssOLS = residuals.reduce((sum, r) => sum + r*r, 0);
            const seOLS = Math.sqrt(rssOLS / (n-2));
            
            // Estimate serial correlation
            let rhoHat = 0;
            if (n > 1) {
                let numeratorRho = 0, denominatorRho = 0;
                for (let i = 1; i < n; i++) {
                    numeratorRho += residuals[i] * residuals[i-1];
                    denominatorRho += residuals[i-1] * residuals[i-1];
                }
                rhoHat = denominatorRho > 0 ? numeratorRho / denominatorRho : 0;
            }

            // Durbin-Watson statistic
            let dwNumerator = 0;
            for (let i = 1; i < n; i++) {
                dwNumerator += Math.pow(residuals[i] - residuals[i-1], 2);
            }
            const dwStatistic = dwNumerator / rssOLS;

            // Efficiency calculations (simplified)
            const efficiency = currentCorrectionSeries.method === 'ols' ? 1.0 : 
                              1.0 + Math.abs(rhoHat) * 0.5; // Approximation

            displayCorrectionResults({
                alphaOLS,
                betaOLS,
                seOLS,
                rhoHat,
                dwStatistic,
                efficiency,
                observations: n,
                method: currentCorrectionSeries.method,
                trueRho: currentCorrectionSeries.rho
            });
        }

        function displayCorrectionResults(results) {
            // Diagnostic Test Table
            document.getElementById('diagnosticTable').innerHTML = `
                <h4>üî¨ Serial Correlation Diagnostic Tests</h4>
                <div style="font-family: 'Source Code Pro', monospace; background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 20px; font-weight: 600; border-bottom: 2px solid #ddd; padding-bottom: 12px;">
                        <div>Test/Statistic</div>
                        <div>Value</div>
                        <div>Critical</div>
                        <div>Conclusion</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 20px; padding: 12px 0;">
                        <div>Durbin-Watson</div>
                        <div class="dw-statistic">${results.dwStatistic.toFixed(3)}</div>
                        <div>1.5-2.5</div>
                        <div>${results.dwStatistic < 1.5 ? 'Positive SC' : results.dwStatistic > 2.5 ? 'Negative SC' : 'No SC'}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 20px; padding: 12px 0; background: rgba(139, 92, 246, 0.1);">
                        <div>Estimated œÅ</div>
                        <div>${results.rhoHat.toFixed(3)}</div>
                        <div>True: ${results.trueRho}</div>
                        <div>${Math.abs(results.rhoHat - results.trueRho) < 0.1 ? 'Accurate' : 'Biased'}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 20px; padding: 12px 0;">
                        <div>OLS Œ≤ÃÇ Standard Error</div>
                        <div>${results.seOLS.toFixed(4)}</div>
                        <div>-</div>
                        <div>Baseline</div>
                    </div>
                </div>
                <div class="wooldridge-note">
                    <p><strong>üéì Wooldridge Interpretation:</strong> 
                    Durbin-Watson of ${results.dwStatistic.toFixed(3)} ${results.dwStatistic < 1.5 ? 
                        'indicates positive serial correlation requiring correction.' : 
                        'suggests serial correlation may not be problematic.'}
                    Using ${results.method.toUpperCase()} method provides ${results.method === 'ols' ? 'no efficiency gain.' : 
                        `${((results.efficiency - 1) * 100).toFixed(1)}% efficiency improvement.`}</p>
                </div>
            `;

            // Update statistics display
            document.getElementById('correctionStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${results.dwStatistic.toFixed(3)}</div>
                    <div class="stat-label">Durbin-Watson</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.rhoHat.toFixed(3)}</div>
                    <div class="stat-label">Estimated œÅ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.seOLS.toFixed(4)}</div>
                    <div class="stat-label">Standard Error</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.observations}</div>
                    <div class="stat-label">Observations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.method.toUpperCase()}</div>
                    <div class="stat-label">Method</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.efficiency.toFixed(2)}x</div>
                    <div class="stat-label">Efficiency</div>
                </div>
            `;

            displayEfficiencyAnalysis(results);
        }

        function displayEfficiencyAnalysis(results) {
            document.getElementById('efficiencyResults').innerHTML = `
                <h4>üéØ Correction Method Efficiency Analysis</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin: 25px 0;">
                    <div class="stat-card">
                        <h5>Method Performance</h5>
                        <p><strong>Current Method:</strong> ${results.method.toUpperCase()}</p>
                        <p><strong>Efficiency Gain:</strong> ${((results.efficiency - 1) * 100).toFixed(1)}%</p>
                        <p><strong>œÅ Estimation:</strong> ${Math.abs(results.rhoHat - results.trueRho) < 0.1 ? 'Accurate' : 'Needs Improvement'}</p>
                    </div>
                    <div class="stat-card">
                        <h5>Policy Implications</h5>
                        <p><strong>Inference Validity:</strong> ${results.dwStatistic < 1.5 && results.method === 'ols' ? 'Invalid' : 'Valid'}</p>
                        <p><strong>Recommended Action:</strong> ${results.dwStatistic < 1.5 ? 'Use FGLS/Prais-Winsten' : 'OLS Acceptable'}</p>
                        <p><strong>Policy Precision:</strong> ${results.efficiency > 1.2 ? 'Much Improved' : 'Moderately Better'}</p>
                    </div>
                </div>
                <div class="correction-highlight">
                    <p><strong>üéì Wooldridge Efficiency Insight:</strong> 
                    ${results.method === 'ols' && results.dwStatistic < 1.5 ? 
                        'OLS standard errors are underestimated with serial correlation. FGLS provides both consistent estimates and correct inference.' :
                        results.method !== 'ols' ?
                        `${results.method.toUpperCase()} correction improves efficiency by accounting for error structure, providing more precise policy conclusions.` :
                        'No serial correlation detected - OLS is efficient and provides valid inference.'
                    }</p>
                </div>
            `;
        }

        // Method Comparison
        function compareMethods() {
            if (!currentCorrectionSeries) {
                alert('Please generate and estimate a model first');
                return;
            }

            updateComparisonChart();
        }

        function updateComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            // Simulate comparison of methods (simplified)
            const methods = ['OLS', 'FGLS', 'Prais-Winsten', 'Cochrane-Orcutt', 'HAC/Robust'];
            const efficiency = [1.0, 1.3, 1.28, 1.25, 1.0]; // Relative efficiency
            const seCorrection = [1.0, 0.85, 0.87, 0.89, 1.1]; // Standard error correction

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: methods,
                    datasets: [{
                        label: 'Relative Efficiency',
                        data: efficiency,
                        backgroundColor: 'rgba(46, 139, 87, 0.7)',
                        borderColor: '#2E8B57',
                        borderWidth: 2,
                        yAxisID: 'y'
                    }, {
                        label: 'SE Correction Factor',
                        data: seCorrection,
                        backgroundColor: 'rgba(139, 92, 246, 0.7)',
                        borderColor: '#8B5CF6',
                        borderWidth: 2,
                        yAxisID: 'y1',
                        type: 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Serial Correlation Correction Method Comparison',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Correction Method' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Efficiency Ratio' },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'SE Correction' },
                            grid: { drawOnChartArea: false },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Assessment Functions
        function generateNewQuestion() {
            currentQuestion = assessmentQuestions[Math.floor(Math.random() * assessmentQuestions.length)];
            selectedAnswer = null;
            
            document.querySelector('.decision-question').textContent = currentQuestion.question;
            
            const optionsContainer = document.getElementById('assessmentOptions');
            optionsContainer.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'decision-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('assessmentFeedback').innerHTML = '';
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            
            document.querySelectorAll('.decision-option').forEach((option, index) => {
                option.classList.toggle('selected', index === answerIndex);
            });
        }

        function checkAnswer() {
            if (selectedAnswer === null) {
                alert('Please select an answer first');
                return;
            }
            
            const isCorrect = selectedAnswer === currentQuestion.correct;
            const feedbackClass = isCorrect ? 'feedback-success' : 'feedback-danger';
            const feedbackTitle = isCorrect ? '‚úì Correct!' : '‚úó Incorrect';
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="${feedbackClass}">
                    <h4>${feedbackTitle}</h4>
                    <p><strong>Explanation:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                </div>
            `;
        }

        function showExpertSolution() {
            if (!currentQuestion) {
                generateNewQuestion();
                return;
            }
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="feedback-success">
                    <h4>üéì Expert Solution</h4>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                    <p><strong>Wooldridge Insight:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Correction Learning:</strong> Chapter 12 provides the essential toolkit for handling serial correlation and heteroskedasticity in time series, ensuring valid inference in policy analysis and economic research.</p>
                </div>
            `;
        }

        // Initialize page
        window.addEventListener('load', function() {
            updateCorrectionSeries();
            generateNewQuestion();
        });
    </script>
</body>
</html>
