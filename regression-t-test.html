<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>t-Test for Regression Slope Œ≤‚ÇÅ - Interactive Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .red-title {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #a71e2a;
        }

        .red-title h1 {
            font-size: 2.3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .red-title p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .blue-concepts {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 25px;
        }

        .blue-concepts h3 {
            font-size: 1.7em;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .measures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .measure-card {
            padding: 18px;
            border-radius: 15px;
            border: 3px solid;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .hyp-card   { background: linear-gradient(135deg, #28a745, #20c997); border-color:#1e7e34; color:white; }
        .tstat-card { background: linear-gradient(135deg, #fd7e14, #e55353); border-color:#d63384; color:white; }
        .crit-card  { background: linear-gradient(135deg, #6f42c1, #8e44ad); border-color:#563d7c; color:white; }
        .pval-card  { background: linear-gradient(135deg, #17a2b8, #138496); border-color:#117a8b; color:white; }
        .interp-card{ background: linear-gradient(135deg, #ffc107, #ff8800); border-color:#d39e00; color:#212529; }

        .measure-card h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
            text-align: center;
        }

        .measure-card .formula {
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-align: center;
            font-size: 0.85em;
        }

        .measure-card .description { margin-bottom: 10px; font-size:0.9em; }
        .measure-card .use-cases   { margin-bottom: 10px; font-style: italic; font-size:0.85em; }
        .measure-card .examples    { font-size:0.8em; border-top: 2px solid rgba(255,255,255,0.3); padding-top: 8px; }

        .interactive-section {
            padding: 25px;
            background: #f8f9fa;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }

        .scenario-display,
        .calculation-area {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .scenario-display { border-left: 5px solid #28a745; }
        .calculation-area { border-left: 5px solid #ffc107; }

        .btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin: 6px 4px;
            box-shadow: 0 4px 10px rgba(40,167,69,0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #20c997, #28a745);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 4px 10px rgba(108,117,125,0.3);
        }

        .data-block {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #007bff;
            margin: 10px 0 0 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size:0.9em;
        }

        .data-table th, .data-table td {
            border: 1px solid #dee2e6;
            padding: 6px 8px;
            text-align: center;
        }

        .options-grid {
            display:grid;
            grid-template-columns: repeat(auto-fit, minmax(230px,1fr));
            gap:10px;
            margin-top:10px;
        }

        .option-checkbox {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            border-radius: 10px;
            padding: 8px 10px;
            border: 2px solid #ced4da;
            display:flex;
            gap:8px;
            align-items:flex-start;
            font-size:0.85em;
        }

        .question-card {
            background:#f8f9fa;
            border-radius:10px;
            border:2px solid #dee2e6;
            padding:12px;
            margin:10px 0;
            font-size:0.9em;
        }

        .question-card h5 {
            margin-bottom:6px;
            color:#007bff;
            font-size:0.95em;
        }

        .question-input {
            margin-top:6px;
            display:flex;
            flex-wrap:wrap;
            align-items:center;
            gap:6px;
        }

        .question-input input {
            padding:6px 8px;
            border-radius:6px;
            border:1px solid #ced4da;
            min-width:120px;
        }

        .feedback {
            margin-top:4px;
            font-size:0.85em;
        }

        .feedback.correct {
            color:#155724;
        }

        .feedback.incorrect {
            color:#721c24;
        }

        .step-explanation {
            margin-top:6px;
            font-size:0.85em;
            background:white;
            border-radius:6px;
            padding:8px;
            border-left:3px solid #17a2b8;
        }

        .interpretation-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding:15px;
            border-radius:10px;
            margin:15px 0;
            border:2px solid #2196f3;
            font-size:0.9em;
        }

        .score-display {
            background: linear-gradient(135deg, #e83e8c, #d91a72);
            color:white;
            padding:15px;
            text-align:center;
            border-radius:12px;
            margin:10px 0 20px 0;
            border:3px solid #c7185d;
            box-shadow:0 4px 15px rgba(232,62,140,0.3);
            font-size:0.9em;
        }

        @media (max-width:768px) {
            .measures-grid { grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="red-title">
        <h1>üìä t-Test for Regression Slope Œ≤‚ÇÅ</h1>
        <p>Practice testing whether an explanatory variable has a statistically significant effect</p>
    </div>

    <div class="blue-concepts">
        <h3>üìò Key Ideas in the t-Test for Œ≤‚ÇÅ</h3>
        <div class="measures-grid">
            <div class="measure-card hyp-card">
                <h4>üìê Hypotheses</h4>
                <div class="formula">
                    H‚ÇÄ: Œ≤‚ÇÅ = Œ≤‚ÇÅ‚ÇÄ (often 0) &nbsp;&nbsp;&nbsp; vs &nbsp;&nbsp;&nbsp; H‚ÇÅ: Œ≤‚ÇÅ ‚â† Œ≤‚ÇÅ‚ÇÄ
                </div>
                <div class="description">
                    We test whether the true slope Œ≤‚ÇÅ is equal to some hypothesized value Œ≤‚ÇÅ‚ÇÄ (often 0 = ‚Äúno effect‚Äù).
                </div>
                <div class="use-cases">
                    <strong>Use:</strong> Is education significantly related to wages? Is price significantly related to demand?
                </div>
                <div class="examples">
                    <strong>Example:</strong> H‚ÇÄ: Œ≤‚ÇÅ = 0 (no effect of education on wage), H‚ÇÅ: Œ≤‚ÇÅ ‚â† 0.
                </div>
            </div>

            <div class="measure-card tstat-card">
                <h4>üìà t-Statistic</h4>
                <div class="formula">
                    t = (Œ≤ÃÇ‚ÇÅ ‚àí Œ≤‚ÇÅ‚ÇÄ) / SE(Œ≤ÃÇ‚ÇÅ)
                </div>
                <div class="description">
                    Measures how many standard errors the estimated slope Œ≤ÃÇ‚ÇÅ is away from the hypothesized value Œ≤‚ÇÅ‚ÇÄ.
                </div>
                <div class="use-cases">
                    <strong>Use:</strong> Large |t| ‚áí strong evidence against H‚ÇÄ.
                </div>
                <div class="examples">
                    <strong>Example:</strong> t = 3.2 means Œ≤ÃÇ‚ÇÅ is 3.2 standard errors above Œ≤‚ÇÅ‚ÇÄ.
                </div>
            </div>

            <div class="measure-card crit-card">
                <h4>üìè Critical Value Rule</h4>
                <div class="formula">
                    Reject H‚ÇÄ if |t| &gt; t<sub>Œ±/2, df</sub>
                </div>
                <div class="description">
                    For a two-sided test at level Œ± (e.g., 5%), compare |t| to the critical t-value with appropriate degrees of freedom.
                </div>
                <div class="use-cases">
                    <strong>Use:</strong> Quick decision rule for significance.
                </div>
                <div class="examples">
                    <strong>Example:</strong> At Œ± = 0.05 and df = 48, t<sub>0.025,48</sub> ‚âà 2.01.
                </div>
            </div>

            <div class="measure-card pval-card">
                <h4>üìâ p-Value</h4>
                <div class="formula">
                    p = P(|T| ‚â• |t|) under H‚ÇÄ
                </div>
                <div class="description">
                    Probability of seeing a t-statistic as extreme as the one observed, assuming the null hypothesis is true.
                </div>
                <div class="use-cases">
                    <strong>Use:</strong> Compare p to Œ±; small p ‚áí strong evidence against H‚ÇÄ.
                </div>
                <div class="examples">
                    <strong>Example:</strong> p = 0.01 ‚áí strong evidence against H‚ÇÄ at the 5% level.
                </div>
            </div>

            <div class="measure-card interp-card">
                <h4>üß† Interpretation</h4>
                <div class="formula">
                    ‚ÄúStatistically significant‚Äù ‚â† ‚Äúcausal‚Äù
                </div>
                <div class="description">
                    If |t| is large and H‚ÇÄ is rejected, we say the estimated slope is statistically significant. We must still be careful about causality.
                </div>
                <div class="use-cases">
                    <strong>Use:</strong> Reporting results in applied work, reading regression output.
                </div>
                <div class="examples">
                    <strong>Example:</strong> ‚ÄúEducation has a positive and statistically significant association with wages at the 5% level.‚Äù
                </div>
            </div>
        </div>
    </div>

    <div class="interactive-section">
        <div class="control-panel">
            <h3>üéÆ Interactive t-Test Practice for Œ≤‚ÇÅ</h3>
            <p>Each scenario gives you an estimated slope Œ≤ÃÇ‚ÇÅ, its standard error, and a critical t-value. Compute the t-statistic and decide whether to reject H‚ÇÄ.</p>
            <button class="btn" onclick="generateScenario()">üìä Generate New Scenario</button>
            <button class="btn btn-secondary" onclick="resetPractice()">üîÑ Reset</button>
        </div>

        <div id="scenarioDisplay" class="scenario-display" style="display:none;">
            <h3 id="scenarioTitle">üìã Scenario</h3>
            <div id="scenarioDescription"></div>
            <div id="dataDisplay"></div>

            <div style="margin-top: 12px; padding: 12px; background:#f8f9fa; border-radius:10px; border-left:4px solid #6c757d;">
                <h4>‚öôÔ∏è Choose Tasks to Practice</h4>
                <p style="font-size:0.85em;color:#555;">
                    Assume a two-sided test at the 5% level (Œ± = 0.05) unless stated otherwise.
                </p>
                <div class="options-grid">
                    <label class="option-checkbox">
                        <input type="checkbox" id="chkTstat" checked>
                        <div><strong>üìà t-statistic</strong><br>Compute t = (Œ≤ÃÇ‚ÇÅ ‚àí Œ≤‚ÇÅ‚ÇÄ) / SE(Œ≤ÃÇ‚ÇÅ).</div>
                    </label>
                    <label class="option-checkbox">
                        <input type="checkbox" id="chkDecision" checked>
                        <div><strong>üìè Decision</strong><br>Type ‚ÄúReject‚Äù or ‚ÄúDo not reject‚Äù based on |t| vs critical value.</div>
                    </label>
                    <label class="option-checkbox">
                        <input type="checkbox" id="chkSignificance" checked>
                        <div><strong>‚≠ê Significance statement</strong><br>Is Œ≤ÃÇ‚ÇÅ statistically significant at the 5% level?</div>
                    </label>
                    <label class="option-checkbox">
                        <input type="checkbox" id="chkInterpret" checked>
                        <div><strong>üß† Economic interpretation (open answer)</strong><br>We won‚Äôt auto-mark this, but we‚Äôll show expert feedback.</div>
                    </label>
                </div>

                <button class="btn" onclick="generateQuestions()" style="margin-top:10px;">üßÆ Generate Questions</button>
            </div>
        </div>

        <div id="calculationArea" class="calculation-area" style="display:none;">
            <h3>üìù Questions & Feedback</h3>
            <div id="questionsContainer"></div>
            <button class="btn" onclick="checkAnswers()">‚úÖ Check Answers</button>
            <div id="interpretationDisplay"></div>
        </div>

        <div class="score-display">
            <h3>üéØ Practice Progress</h3>
            <div>Scenarios Practiced: <span id="scenariosCompleted">0</span></div>
        </div>
    </div>
</div>

<script>
    console.log("t-test for slope Œ≤1 practice loaded.");

    var currentScenario = null;
    var scenariosCompleted = 0;
    var currentQuestions = [];

    var scenarios = [
        {
            id: "wageEdu",
            title: "Hourly Wage vs Years of Education",
            description: "A cross-sectional regression of hourly wage (Y, $/hour) on years of education (X) is estimated using a sample of n = 50 workers.",
            context: "Test whether education has a statistically significant association with wages.",
            xVar: "years of education",
            yVar: "hourly wage",
            beta1hat: 1.8,
            se1: 0.6,
            beta10: 0.0,
            df: 48,
            tCritTwo: 2.01,
            direction: "Each extra year of education is associated with about $1.8 higher hourly wage."
        },
        {
            id: "consIncome",
            title: "Monthly Consumption vs Income",
            description: "A regression of monthly consumption spending (Y, $100s) on monthly income (X, $100s) is estimated using n = 60 households.",
            context: "Test whether income has a statistically significant effect on consumption.",
            xVar: "monthly income (hundreds of $)",
            yVar: "monthly consumption (hundreds of $)",
            beta1hat: 0.75,
            se1: 0.25,
            beta10: 0.0,
            df: 58,
            tCritTwo: 2.00,
            direction: "Each extra $100 of income is associated with about $75 higher consumption."
        },
        {
            id: "unempGDP",
            title: "Unemployment vs GDP Growth",
            description: "Using quarterly data (n = 40), a regression of unemployment rate (Y, %) on GDP growth (X, %) is estimated.",
            context: "Test whether GDP growth is significantly related to changes in unemployment.",
            xVar: "GDP growth (percentage points)",
            yVar: "unemployment rate (percent)",
            beta1hat: -0.45,
            se1: 0.20,
            beta10: 0.0,
            df: 38,
            tCritTwo: 2.02,
            direction: "Each 1 percentage point increase in GDP growth is associated with about 0.45 percentage point lower unemployment."
        }
    ];

    function generateScenario() {
        var idx = Math.floor(Math.random() * scenarios.length);
        currentScenario = scenarios[idx];
        console.log("Scenario:", currentScenario.id);

        currentQuestions = [];

        document.getElementById("scenarioDisplay").style.display = "block";
        document.getElementById("calculationArea").style.display = "none";
        document.getElementById("interpretationDisplay").innerHTML = "";
        document.getElementById("questionsContainer").innerHTML = "";

        document.getElementById("scenarioTitle").textContent = "üìä " + currentScenario.title;

        var descHtml = "";
        descHtml += '<div class="data-block">';
        descHtml += '<h4>üìã Context:</h4>';
        descHtml += '<p style="margin-top:8px;">' + currentScenario.description + '</p>';
        descHtml += '<p style="margin-top:8px;font-style:italic;color:#6c757d;"><strong>Goal:</strong> ' +
                    currentScenario.context + '</p>';
        descHtml += '<p style="margin-top:8px;font-size:0.9em;"><strong>Null hypothesis (two-sided):</strong> H‚ÇÄ: Œ≤‚ÇÅ = ' +
                    currentScenario.beta10 + '</p>';
        descHtml += '</div>';
        document.getElementById("scenarioDescription").innerHTML = descHtml;

        displayData(currentScenario);

        document.getElementById("chkTstat").checked = true;
        document.getElementById("chkDecision").checked = true;
        document.getElementById("chkSignificance").checked = true;
        document.getElementById("chkInterpret").checked = true;
    }

    function displayData(scenario) {
        var tStat = (scenario.beta1hat - scenario.beta10) / scenario.se1;

        var html = "";
        html += '<h4>üìã Estimated Slope and Standard Error</h4>';
        html += '<div class="data-block">';
        html += '<table class="data-table">';
        html += '<thead><tr><th>n</th><th>df</th><th>Œ≤ÃÇ‚ÇÅ</th><th>SE(Œ≤ÃÇ‚ÇÅ)</th><th>H‚ÇÄ: Œ≤‚ÇÅ</th><th>t critical (5%, two-sided)</th></tr></thead><tbody>';
        html += '<tr>';
        html += '<td>' + (scenario.df + scenarioDegreesOffset()) + '</td>';
        html += '<td>' + scenario.df + '</td>';
        html += '<td>' + scenario.beta1hat.toFixed(3) + '</td>';
        html += '<td>' + scenario.se1.toFixed(3) + '</td>';
        html += '<td>' + scenario.beta10.toFixed(3) + '</td>';
        html += '<td>' + scenario.tCritTwo.toFixed(2) + '</td>';
        html += '</tr>';
        html += '</tbody></table>';
        html += '<p style="margin-top:8px;font-size:0.9em;"><strong>Interpretation of Œ≤ÃÇ‚ÇÅ:</strong> ' +
                scenario.direction + '</p>';
        html += '</div>';

        document.getElementById("dataDisplay").innerHTML = html;
    }

    function scenarioDegreesOffset() {
        // df = n ‚àí k ‚àí 1, with k around 1 in these examples.
        // We'll just infer n = df + 2 for display, as the specific n isn't crucial.
        return 2;
    }

    function generateQuestions() {
        if (!currentScenario) {
            alert("Please generate a scenario first.");
            return;
        }

        currentQuestions = [];
        var container = document.getElementById("questionsContainer");
        container.innerHTML = "";

        var chkTstat       = document.getElementById("chkTstat").checked;
        var chkDecision    = document.getElementById("chkDecision").checked;
        var chkSignificance= document.getElementById("chkSignificance").checked;
        var chkInterpret   = document.getElementById("chkInterpret").checked;

        var tStat = (currentScenario.beta1hat - currentScenario.beta10) / currentScenario.se1;
        var isSignificant = Math.abs(tStat) > currentScenario.tCritTwo;

        if (chkTstat) {
            currentQuestions.push({
                conceptId: "tstat",
                type: "numeric",
                title: "üìà t-Statistic for Œ≤‚ÇÅ",
                prompt: "Compute the t-statistic t = (Œ≤ÃÇ‚ÇÅ ‚àí Œ≤‚ÇÅ‚ÇÄ) / SE(Œ≤ÃÇ‚ÇÅ).",
                correctValue: tStat,
                unitHint: "(t-statistic)"
            });
        }

        if (chkDecision) {
            currentQuestions.push({
                conceptId: "decision",
                type: "choice",
                title: "üìè Decision at 5% Level",
                prompt: "Based on |t| and the critical value t‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ,df, should you ‚ÄúReject‚Äù or ‚ÄúDo not reject‚Äù H‚ÇÄ?",
                correctText: isSignificant ? "reject" : "do not reject",
                unitHint: '(type exactly "Reject" or "Do not reject")'
            });
        }

        if (chkSignificance) {
            currentQuestions.push({
                conceptId: "significance",
                type: "choice",
                title: "‚≠ê Is Œ≤ÃÇ‚ÇÅ Statistically Significant at 5%?",
                prompt: 'Answer ‚ÄúYes‚Äù if the slope is statistically significant at the 5% level, or ‚ÄúNo‚Äù otherwise.',
                correctText: isSignificant ? "yes" : "no",
                unitHint: '(type "Yes" or "No")'
            });
        }

        if (chkInterpret) {
            currentQuestions.push({
                conceptId: "interpret",
                type: "open",
                title: "üß† Economic Interpretation (Open Answer)",
                prompt: "In words, interpret Œ≤ÃÇ‚ÇÅ and your test result in the context of this scenario (no automatic marking, but feedback will appear).",
                correctText: "", // we will just show expert interpretation
                unitHint: "(write a short sentence or two)"
            });
        }

        if (currentQuestions.length === 0) {
            container.innerHTML = "<p>No tasks selected. Tick at least one box.</p>";
            document.getElementById("calculationArea").style.display = "block";
            return;
        }

        var html = "";
        for (var i = 0; i < currentQuestions.length; i++) {
            html += renderQuestionCard(currentQuestions[i], i);
        }
        container.innerHTML = html;

        document.getElementById("calculationArea").style.display = "block";
        document.getElementById("interpretationDisplay").innerHTML = "";
    }

    function renderQuestionCard(q, index) {
        var html = "";
        html += '<div class="question-card">';
        html += '<h5>' + q.title + '</h5>';
        html += '<p>' + q.prompt + '</p>';
        html += '<div class="question-input">';
        html += '<label for="answer_' + index + '"><strong>Your answer:</strong></label>';
        if (q.type === "open") {
            html += '<input type="text" id="answer_' + index + '">';
        } else {
            html += '<input type="text" id="answer_' + index + '">';
        }
        if (q.unitHint) {
            html += '<span>' + q.unitHint + '</span>';
        }
        html += '</div>';
        html += '<div id="feedback_' + index + '" class="feedback"></div>';
        html += '<div id="explain_' + index + '" class="step-explanation" style="display:none;"></div>';
        html += '</div>';
        return html;
    }

    function checkAnswers() {
        if (currentQuestions.length === 0) {
            alert("No questions to check. Generate questions first.");
            return;
        }

        var numCorrect = 0;

        for (var i = 0; i < currentQuestions.length; i++) {
            var q = currentQuestions[i];
            var ansInput = document.getElementById("answer_" + i);
            var feedbackEl = document.getElementById("feedback_" + i);
            var explainEl = document.getElementById("explain_" + i);

            if (!ansInput) continue;

            var userRaw = ansInput.value.trim();
            if (userRaw === "") {
                feedbackEl.textContent = "Please enter an answer.";
                feedbackEl.className = "feedback";
                explainEl.style.display = "none";
                continue;
            }

            if (q.type === "numeric") {
                var userVal = parseFloat(userRaw);
                if (isNaN(userVal)) {
                    feedbackEl.textContent = "Please enter a numeric answer.";
                    feedbackEl.className = "feedback";
                    explainEl.style.display = "none";
                    continue;
                }
                var correct = q.correctValue;
                var ok = isCloseNumeric(userVal, correct);
                if (ok) {
                    numCorrect++;
                    feedbackEl.textContent = "‚úÖ Correct (expected about " + correct.toFixed(3) + ").";
                    feedbackEl.className = "feedback correct";
                } else {
                    feedbackEl.textContent = "‚ùå Not quite. A good answer is about " + correct.toFixed(3) + ".";
                    feedbackEl.className = "feedback incorrect";
                }
            } else if (q.type === "choice") {
                var norm = userRaw.toLowerCase();
                var correctNorm = q.correctText.toLowerCase();
                var okChoice = false;

                if (correctNorm === "reject") {
                    okChoice = (norm === "reject");
                } else if (correctNorm === "do not reject") {
                    okChoice = (norm === "do not reject" || norm === "do not reject h0" || norm === "do not reject h‚ÇÄ");
                } else if (correctNorm === "yes") {
                    okChoice = (norm === "yes");
                } else if (correctNorm === "no") {
                    okChoice = (norm === "no");
                }

                if (okChoice) {
                    numCorrect++;
                    feedbackEl.textContent = "‚úÖ Correct.";
                    feedbackEl.className = "feedback correct";
                } else {
                    feedbackEl.textContent = "‚ùå Not quite. The expected answer here is \"" +
                        (q.correctText.charAt(0).toUpperCase() + q.correctText.slice(1)) + "\".";
                    feedbackEl.className = "feedback incorrect";
                }
            } else if (q.type === "open") {
                // No correctness check; just acknowledge and show expert interpretation.
                feedbackEl.textContent = "üìù Thanks for your explanation. Compare with the expert interpretation below.";
                feedbackEl.className = "feedback";
            }

            explainEl.innerHTML = getExplanationHtml(q);
            explainEl.style.display = "block";
        }

        var interpLines = [];
        interpLines.push("‚Ä¢ You answered " + numCorrect + " out of " + currentQuestions.length + " auto-graded questions correctly (within tolerance).");
        interpLines.push("‚Ä¢ Use the explanations to solidify the link between Œ≤ÃÇ‚ÇÅ, its standard error, the t-statistic, and the decision rule.");
        document.getElementById("interpretationDisplay").innerHTML =
            '<div class="interpretation-box"><h4>üß† Summary of This Practice Round</h4>' +
            interpLines.join("<br>") + '</div>';

        scenariosCompleted++;
        document.getElementById("scenariosCompleted").textContent = String(scenariosCompleted);
    }

    function isCloseNumeric(userVal, correctVal) {
        var diff = Math.abs(userVal - correctVal);
        var tol = Math.max(0.05, Math.abs(correctVal) * 0.03); // about ¬±3% or at least 0.05
        return diff <= tol;
    }

    function getExplanationHtml(q) {
        if (!currentScenario) return "";

        var tStat = (currentScenario.beta1hat - currentScenario.beta10) / currentScenario.se1;
        var isSignificant = Math.abs(tStat) > currentScenario.tCritTwo;

        var html = "<strong>How to think about this:</strong><br>";

        if (q.conceptId === "tstat") {
            html += "1. Start from the hypotheses: H‚ÇÄ: Œ≤‚ÇÅ = " + currentScenario.beta10.toFixed(2) + ".<br>";
            html += "2. The estimated slope is Œ≤ÃÇ‚ÇÅ = " + currentScenario.beta1hat.toFixed(3) +
                    " with SE(Œ≤ÃÇ‚ÇÅ) = " + currentScenario.se1.toFixed(3) + ".<br>";
            html += "3. Compute t = (Œ≤ÃÇ‚ÇÅ ‚àí Œ≤‚ÇÅ‚ÇÄ) / SE(Œ≤ÃÇ‚ÇÅ).<br>";
            html += "4. Here: t ‚âà " + tStat.toFixed(3) + ".";
        } else if (q.conceptId === "decision") {
            html += "1. Use the two-sided 5% test: reject H‚ÇÄ if |t| &gt; t<sub>0.025, df</sub>.<br>";
            html += "2. For this scenario, df = " + currentScenario.df +
                    " and t<sub>0.025," + currentScenario.df + "</sub> ‚âà " + currentScenario.tCritTwo.toFixed(2) + ".<br>";
            html += "3. The t-statistic is about " + tStat.toFixed(3) + ", so |t| = " + Math.abs(tStat).toFixed(3) + ".<br>";
            html += "4. Compare |t| to the critical value and make your decision accordingly.";
        } else if (q.conceptId === "significance") {
            if (isSignificant) {
                html += "Since |t| ‚âà " + Math.abs(tStat).toFixed(3) +
                        " is larger than the critical value " + currentScenario.tCritTwo.toFixed(2) +
                        ", we reject H‚ÇÄ at the 5% level.<br>";
                html += "So the slope is statistically significant at the 5% level.";
            } else {
                html += "Since |t| ‚âà " + Math.abs(tStat).toFixed(3) +
                        " is not larger than the critical value " + currentScenario.tCritTwo.toFixed(2) +
                        ", we do not reject H‚ÇÄ at the 5% level.<br>";
                html += "So the slope is not statistically significant at the 5% level.";
            }
        } else if (q.conceptId === "interpret") {
            html += "In words, you might say something like:<br>";
            if (currentScenario.id === "wageEdu") {
                html += "‚ÄúEach extra year of education is associated with about $" +
                        currentScenario.beta1hat.toFixed(2) +
                        " higher hourly wage, and this effect " +
                        (isSignificant ? "is" : "is not") +
                        " statistically significant at the 5% level.‚Äù";
            } else if (currentScenario.id === "consIncome") {
                html += "‚ÄúEach extra $100 of income is associated with about $" +
                        (currentScenario.beta1hat * 100).toFixed(2) +
                        " higher monthly consumption, and this slope " +
                        (isSignificant ? "is" : "is not") +
                        " statistically significant at the 5% level.‚Äù";
            } else if (currentScenario.id === "unempGDP") {
                html += "‚ÄúEach 1 percentage point increase in GDP growth is associated with about " +
                        currentScenario.beta1hat.toFixed(2) +
                        " percentage points change in unemployment, and this relationship " +
                        (isSignificant ? "is" : "is not") +
                        " statistically significant at the 5% level.‚Äù";
            } else {
                html += "‚ÄúThe estimated slope describes how Y changes with X, and your decision tells you whether this effect is statistically significant at the chosen level.‚Äù";
            }
        } else {
            html += "Review the definition of the t-test and how it relates Œ≤ÃÇ‚ÇÅ, its standard error, and the null hypothesis.";
        }

        return html;
    }

    function resetPractice() {
        currentScenario = null;
        currentQuestions = [];
        scenariosCompleted = 0;
        document.getElementById("scenariosCompleted").textContent = "0";
        document.getElementById("scenarioDisplay").style.display = "none";
        document.getElementById("calculationArea").style.display = "none";
        document.getElementById("questionsContainer").innerHTML = "";
        document.getElementById("interpretationDisplay").innerHTML = "";
        document.getElementById("dataDisplay").innerHTML = "";
        document.getElementById("scenarioDescription").innerHTML = "";
        console.log("t-test practice reset.");
    }

    document.getElementById("scenariosCompleted").textContent = "0";
</script>
</body>
</html>
